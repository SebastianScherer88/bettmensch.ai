{
    "api_version": null,
    "kind": null,
    "metadata": {
        "annotations": {
            "karpenter.sh/do-not-disrupt": "true",
            "workflows.argoproj.io/pod-name-format": "v2"
        },
        "cluster_name": null,
        "creation_timestamp": "test-datetime-value",
        "deletion_grace_period_seconds": null,
        "deletion_timestamp": null,
        "finalizers": null,
        "generate_name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-",
        "generation": 12,
        "labels": {
            "workflows.argoproj.io/completed": "true",
            "workflows.argoproj.io/creator": "system-serviceaccount-argo-argo-server",
            "workflows.argoproj.io/phase": "Succeeded"
        },
        "managed_fields": [
            {
                "api_version": "argoproj.io/v1alpha1",
                "fields_type": "FieldsV1",
                "fields_v1": {},
                "manager": "argo",
                "operation": "Update",
                "subresource": null,
                "time": "test-datetime-value"
            },
            {
                "api_version": "argoproj.io/v1alpha1",
                "fields_type": "FieldsV1",
                "fields_v1": {},
                "manager": "workflow-controller",
                "operation": "Update",
                "subresource": null,
                "time": "test-datetime-value"
            }
        ],
        "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
        "namespace": "argo",
        "owner_references": null,
        "resource_version": "17861",
        "self_link": null,
        "uid": "d48f4d8d-61b1-4b86-a200-49c525c6f516"
    },
    "spec": {
        "active_deadline_seconds": null,
        "affinity": null,
        "archive_logs": null,
        "arguments": {
            "artifacts": null,
            "parameters": [
                {
                    "default": null,
                    "description": null,
                    "enum": null,
                    "global_name": null,
                    "name": "max_time",
                    "value": "00:00:00:20",
                    "value_from": null
                }
            ]
        },
        "artifact_gc": null,
        "artifact_repository_ref": null,
        "automount_service_account_token": null,
        "dns_config": null,
        "dns_policy": null,
        "entrypoint": null,
        "executor": null,
        "hooks": null,
        "host_aliases": null,
        "host_network": null,
        "image_pull_secrets": null,
        "metrics": null,
        "node_selector": null,
        "on_exit": null,
        "parallelism": null,
        "pod_disruption_budget": null,
        "pod_gc": null,
        "pod_metadata": null,
        "pod_priority": null,
        "pod_priority_class_name": null,
        "pod_spec_patch": null,
        "priority": null,
        "retry_strategy": null,
        "scheduler_name": null,
        "security_context": null,
        "service_account_name": null,
        "shutdown": null,
        "suspend": null,
        "synchronization": null,
        "template_defaults": null,
        "templates": null,
        "tolerations": null,
        "ttl_strategy": null,
        "volume_claim_gc": null,
        "volume_claim_templates": null,
        "volumes": null,
        "workflow_metadata": null,
        "workflow_template_ref": {
            "cluster_scope": null,
            "name": "pipeline-test-lightning-gpu-pipeline-9r6h2"
        }
    },
    "status": {
        "artifact_gc_status": {
            "not_specified": true,
            "pods_recouped": null,
            "strategies_processed": null
        },
        "artifact_repository_ref": {
            "artifact_repository": {
                "archive_logs": null,
                "artifactory": null,
                "azure": null,
                "gcs": null,
                "hdfs": null,
                "oss": null,
                "s3": {
                    "access_key_secret": null,
                    "bucket": "bettmensch-ai-artifact-repository",
                    "ca_secret": null,
                    "create_bucket_if_not_present": null,
                    "encryption_options": null,
                    "endpoint": "s3.us-east-2.amazonaws.com",
                    "insecure": true,
                    "key_format": null,
                    "key_prefix": null,
                    "region": null,
                    "role_arn": null,
                    "secret_key_secret": null,
                    "use_sdk_creds": null
                }
            },
            "config_map": "artifact-repositories",
            "default": null,
            "key": "bettmensch-ai-artifact-repository",
            "namespace": "argo"
        },
        "compressed_nodes": null,
        "conditions": [
            {
                "message": null,
                "status": "False",
                "type": "PodRunning"
            },
            {
                "message": null,
                "status": "True",
                "type": "Completed"
            }
        ],
        "estimated_duration": null,
        "finished_at": "test-datetime-value",
        "message": null,
        "nodes": {
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d": {
                "boundary_id": null,
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-966953919"
                ],
                "daemoned": null,
                "display_name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": null,
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "inputs": null,
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "node_flag": null,
                "outbound_nodes": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1639120660",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3295920951",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3164367506",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2871044736",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1820439476"
                ],
                "outputs": null,
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "7/7",
                "resources_duration": {
                    "cpu": 128,
                    "memory": 2228,
                    "nvidia.com/gpu": 179
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "bettmensch-ai-dag",
                "template_ref": null,
                "template_scope": "local/",
                "type": "DAG"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1639120660": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": null,
                "daemoned": null,
                "display_name": "lightning-ddp-0-worker-1(0)",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": "ip-10-0-49-51.us-east-2.compute.internal",
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1639120660",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0-worker-1(0)",
                "node_flag": {
                    "hooked": null,
                    "retried": true
                },
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:23.332028",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 34,
                    "memory": 587,
                    "nvidia.com/gpu": 48
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-1",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Pod"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1697154233": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2871044736",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3009250645"
                ],
                "daemoned": null,
                "display_name": "lightning-ddp-0(0)",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": "ip-10-0-49-145.us-east-2.compute.internal",
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1697154233",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0(0)",
                "node_flag": {
                    "hooked": null,
                    "retried": true
                },
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:23.295598",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 26,
                    "memory": 467,
                    "nvidia.com/gpu": 37
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-0",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Pod"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1820439476": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": null,
                "daemoned": null,
                "display_name": "show-duration-param-0(0)",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1820439476",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "a",
                            "value": "0:00:23.295598",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.show-duration-param-0(0)",
                "node_flag": {
                    "hooked": null,
                    "retried": true
                },
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": null,
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 1,
                    "memory": 24
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "show-duration-param",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Pod"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2032602050": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1697154233"
                ],
                "daemoned": null,
                "display_name": "lightning-ddp-0",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": null,
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2032602050",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0",
                "node_flag": null,
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:23.295598",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "3/3",
                "resources_duration": {
                    "cpu": 27,
                    "memory": 491,
                    "nvidia.com/gpu": 37
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-0",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Retry"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2871044736": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": null,
                "daemoned": null,
                "display_name": "lightning-ddp-delete-torch-service",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2871044736",
                "inputs": null,
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-delete-torch-service",
                "node_flag": null,
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": null,
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 0,
                    "memory": 0
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-delete-torch-service",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Pod"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3009250645": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1820439476"
                ],
                "daemoned": null,
                "display_name": "show-duration-param-0",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": null,
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3009250645",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "a",
                            "value": "0:00:23.295598",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.show-duration-param-0",
                "node_flag": null,
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": null,
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 1,
                    "memory": 24
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "show-duration-param",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Retry"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3164367506": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": null,
                "daemoned": null,
                "display_name": "lightning-ddp-0-worker-3(0)",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": "ip-10-0-50-29.us-east-2.compute.internal",
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3164367506",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0-worker-3(0)",
                "node_flag": {
                    "hooked": null,
                    "retried": true
                },
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:22.990339",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 36,
                    "memory": 606,
                    "nvidia.com/gpu": 50
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-3",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Pod"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3295920951": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": null,
                "daemoned": null,
                "display_name": "lightning-ddp-0-worker-2(0)",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": "ip-10-0-50-166.us-east-2.compute.internal",
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3295920951",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0-worker-2(0)",
                "node_flag": {
                    "hooked": null,
                    "retried": true
                },
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:22.838134",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 31,
                    "memory": 544,
                    "nvidia.com/gpu": 44
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-2",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Pod"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-855475196": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3295920951"
                ],
                "daemoned": null,
                "display_name": "lightning-ddp-0-worker-2",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": null,
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-855475196",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0-worker-2",
                "node_flag": null,
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:22.838134",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 31,
                    "memory": 544,
                    "nvidia.com/gpu": 44
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-2",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Retry"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-872252815": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3164367506"
                ],
                "daemoned": null,
                "display_name": "lightning-ddp-0-worker-3",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": null,
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-872252815",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0-worker-3",
                "node_flag": null,
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:22.990339",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 36,
                    "memory": 606,
                    "nvidia.com/gpu": 50
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-3",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Retry"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-905808053": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1639120660"
                ],
                "daemoned": null,
                "display_name": "lightning-ddp-0-worker-1",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": null,
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-905808053",
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": "00:00:00:20",
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "null",
                            "value_from": null
                        }
                    ]
                },
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-0-worker-1",
                "node_flag": null,
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": "0:00:23.332028",
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 34,
                    "memory": 587,
                    "nvidia.com/gpu": 48
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-1",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Retry"
            },
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-966953919": {
                "boundary_id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d",
                "children": [
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-905808053",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-855475196",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-872252815",
                    "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2032602050"
                ],
                "daemoned": null,
                "display_name": "lightning-ddp-create-torch-service",
                "estimated_duration": null,
                "finished_at": "test-datetime-value",
                "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                "id": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-966953919",
                "inputs": null,
                "memoization_status": null,
                "message": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d.lightning-ddp-create-torch-service",
                "node_flag": null,
                "outbound_nodes": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": "0",
                    "parameters": null,
                    "result": null
                },
                "phase": "Succeeded",
                "pod_ip": null,
                "progress": "1/1",
                "resources_duration": {
                    "cpu": 0,
                    "memory": 0
                },
                "started_at": "test-datetime-value",
                "synchronization_status": null,
                "template_name": "lightning-ddp-create-torch-service",
                "template_ref": null,
                "template_scope": "local/",
                "type": "Pod"
            }
        },
        "offload_node_status_version": null,
        "outputs": null,
        "persistent_volume_claims": null,
        "phase": "Succeeded",
        "progress": "7/7",
        "resources_duration": {
            "cpu": 128,
            "memory": 2228,
            "nvidia.com/gpu": 179
        },
        "started_at": "test-datetime-value",
        "stored_templates": {
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/bettmensch-ai-dag": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": {
                    "fail_fast": null,
                    "target": null,
                    "tasks": [
                        {
                            "arguments": {
                                "artifacts": null,
                                "parameters": null
                            },
                            "continue_on": null,
                            "dependencies": null,
                            "depends": null,
                            "hooks": null,
                            "inline": null,
                            "name": "lightning-ddp-create-torch-service",
                            "on_exit": null,
                            "template": "lightning-ddp-create-torch-service",
                            "template_ref": null,
                            "when": null,
                            "with_items": null,
                            "with_param": null,
                            "with_sequence": null
                        },
                        {
                            "arguments": {
                                "artifacts": null,
                                "parameters": [
                                    {
                                        "default": null,
                                        "description": null,
                                        "enum": null,
                                        "global_name": null,
                                        "name": "max_time",
                                        "value": "{{workflow.parameters.max_time}}",
                                        "value_from": null
                                    }
                                ]
                            },
                            "continue_on": null,
                            "dependencies": null,
                            "depends": "lightning-ddp-create-torch-service",
                            "hooks": null,
                            "inline": null,
                            "name": "lightning-ddp-0",
                            "on_exit": null,
                            "template": "lightning-ddp-0",
                            "template_ref": null,
                            "when": null,
                            "with_items": null,
                            "with_param": null,
                            "with_sequence": null
                        },
                        {
                            "arguments": {
                                "artifacts": null,
                                "parameters": [
                                    {
                                        "default": null,
                                        "description": null,
                                        "enum": null,
                                        "global_name": null,
                                        "name": "max_time",
                                        "value": "{{workflow.parameters.max_time}}",
                                        "value_from": null
                                    }
                                ]
                            },
                            "continue_on": null,
                            "dependencies": null,
                            "depends": "lightning-ddp-create-torch-service",
                            "hooks": null,
                            "inline": null,
                            "name": "lightning-ddp-0-worker-1",
                            "on_exit": null,
                            "template": "lightning-ddp-1",
                            "template_ref": null,
                            "when": null,
                            "with_items": null,
                            "with_param": null,
                            "with_sequence": null
                        },
                        {
                            "arguments": {
                                "artifacts": null,
                                "parameters": [
                                    {
                                        "default": null,
                                        "description": null,
                                        "enum": null,
                                        "global_name": null,
                                        "name": "max_time",
                                        "value": "{{workflow.parameters.max_time}}",
                                        "value_from": null
                                    }
                                ]
                            },
                            "continue_on": null,
                            "dependencies": null,
                            "depends": "lightning-ddp-create-torch-service",
                            "hooks": null,
                            "inline": null,
                            "name": "lightning-ddp-0-worker-2",
                            "on_exit": null,
                            "template": "lightning-ddp-2",
                            "template_ref": null,
                            "when": null,
                            "with_items": null,
                            "with_param": null,
                            "with_sequence": null
                        },
                        {
                            "arguments": {
                                "artifacts": null,
                                "parameters": [
                                    {
                                        "default": null,
                                        "description": null,
                                        "enum": null,
                                        "global_name": null,
                                        "name": "max_time",
                                        "value": "{{workflow.parameters.max_time}}",
                                        "value_from": null
                                    }
                                ]
                            },
                            "continue_on": null,
                            "dependencies": null,
                            "depends": "lightning-ddp-create-torch-service",
                            "hooks": null,
                            "inline": null,
                            "name": "lightning-ddp-0-worker-3",
                            "on_exit": null,
                            "template": "lightning-ddp-3",
                            "template_ref": null,
                            "when": null,
                            "with_items": null,
                            "with_param": null,
                            "with_sequence": null
                        },
                        {
                            "arguments": {
                                "artifacts": null,
                                "parameters": null
                            },
                            "continue_on": null,
                            "dependencies": null,
                            "depends": "lightning-ddp-0",
                            "hooks": null,
                            "inline": null,
                            "name": "lightning-ddp-delete-torch-service",
                            "on_exit": null,
                            "template": "lightning-ddp-delete-torch-service",
                            "template_ref": null,
                            "when": null,
                            "with_items": null,
                            "with_param": null,
                            "with_sequence": null
                        },
                        {
                            "arguments": {
                                "artifacts": null,
                                "parameters": [
                                    {
                                        "default": null,
                                        "description": null,
                                        "enum": null,
                                        "global_name": null,
                                        "name": "a",
                                        "value": "{{tasks.lightning-ddp-0.outputs.parameters.duration}}",
                                        "value_from": null
                                    }
                                ]
                            },
                            "continue_on": null,
                            "dependencies": null,
                            "depends": "lightning-ddp-0",
                            "hooks": null,
                            "inline": null,
                            "name": "show-duration-param-0",
                            "on_exit": null,
                            "template": "show-duration-param",
                            "template_ref": null,
                            "when": null,
                            "with_items": null,
                            "with_param": null,
                            "with_sequence": null
                        }
                    ]
                },
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": null
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": null
                },
                "metrics": null,
                "name": "bettmensch-ai-dag",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": null,
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": null,
                "priority": null,
                "priority_class_name": null,
                "resource": null,
                "retry_strategy": null,
                "scheduler_name": null,
                "script": null,
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": null,
                "volumes": null
            },
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/lightning-ddp-0": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": null,
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": null,
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": null
                        }
                    ]
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": {
                        "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                        "torch-node": "0"
                    }
                },
                "metrics": null,
                "name": "lightning-ddp-0",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                "priority": null,
                "priority_class_name": null,
                "resource": null,
                "retry_strategy": {
                    "affinity": null,
                    "backoff": null,
                    "expression": null,
                    "limit": "1",
                    "retry_policy": "OnError"
                },
                "scheduler_name": null,
                "script": {
                    "args": null,
                    "command": [
                        "python"
                    ],
                    "env": [
                        {
                            "name": "NCCL_DEBUG",
                            "value": "INFO",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_node_rank",
                            "value": "0",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_start_method",
                            "value": "fork",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                            "value": "static",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                            "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                            "value": "29200",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_run_id",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_tee",
                            "value": "0",
                            "value_from": null
                        }
                    ],
                    "env_from": null,
                    "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                    "image_pull_policy": "Always",
                    "lifecycle": null,
                    "liveness_probe": null,
                    "name": "",
                    "ports": [
                        {
                            "container_port": 29200,
                            "host_ip": null,
                            "host_port": null,
                            "name": "ddp",
                            "protocol": "TCP"
                        }
                    ],
                    "readiness_probe": null,
                    "resources": {
                        "limits": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        },
                        "requests": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        }
                    },
                    "security_context": null,
                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                    "startup_probe": null,
                    "stdin": null,
                    "stdin_once": null,
                    "termination_message_path": null,
                    "termination_message_policy": null,
                    "tty": null,
                    "volume_devices": null,
                    "volume_mounts": null,
                    "working_dir": null
                },
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": [
                    {
                        "effect": "NoSchedule",
                        "key": "nvidia.com/gpu",
                        "operator": "Exists",
                        "toleration_seconds": null,
                        "value": null
                    }
                ],
                "volumes": null
            },
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/lightning-ddp-1": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": null,
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": null,
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": null
                        }
                    ]
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": {
                        "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                        "torch-node": "1"
                    }
                },
                "metrics": null,
                "name": "lightning-ddp-1",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                "priority": null,
                "priority_class_name": null,
                "resource": null,
                "retry_strategy": {
                    "affinity": null,
                    "backoff": null,
                    "expression": null,
                    "limit": "1",
                    "retry_policy": "OnError"
                },
                "scheduler_name": null,
                "script": {
                    "args": null,
                    "command": [
                        "python"
                    ],
                    "env": [
                        {
                            "name": "NCCL_DEBUG",
                            "value": "INFO",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_node_rank",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_start_method",
                            "value": "fork",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                            "value": "static",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                            "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                            "value": "29200",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_run_id",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_tee",
                            "value": "0",
                            "value_from": null
                        }
                    ],
                    "env_from": null,
                    "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                    "image_pull_policy": "Always",
                    "lifecycle": null,
                    "liveness_probe": null,
                    "name": "",
                    "ports": null,
                    "readiness_probe": null,
                    "resources": {
                        "limits": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        },
                        "requests": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        }
                    },
                    "security_context": null,
                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                    "startup_probe": null,
                    "stdin": null,
                    "stdin_once": null,
                    "termination_message_path": null,
                    "termination_message_policy": null,
                    "tty": null,
                    "volume_devices": null,
                    "volume_mounts": null,
                    "working_dir": null
                },
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": [
                    {
                        "effect": "NoSchedule",
                        "key": "nvidia.com/gpu",
                        "operator": "Exists",
                        "toleration_seconds": null,
                        "value": null
                    }
                ],
                "volumes": null
            },
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/lightning-ddp-2": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": null,
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": null,
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": null
                        }
                    ]
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": {
                        "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                        "torch-node": "2"
                    }
                },
                "metrics": null,
                "name": "lightning-ddp-2",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                "priority": null,
                "priority_class_name": null,
                "resource": null,
                "retry_strategy": {
                    "affinity": null,
                    "backoff": null,
                    "expression": null,
                    "limit": "1",
                    "retry_policy": "OnError"
                },
                "scheduler_name": null,
                "script": {
                    "args": null,
                    "command": [
                        "python"
                    ],
                    "env": [
                        {
                            "name": "NCCL_DEBUG",
                            "value": "INFO",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_node_rank",
                            "value": "2",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_start_method",
                            "value": "fork",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                            "value": "static",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                            "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                            "value": "29200",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_run_id",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_tee",
                            "value": "0",
                            "value_from": null
                        }
                    ],
                    "env_from": null,
                    "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                    "image_pull_policy": "Always",
                    "lifecycle": null,
                    "liveness_probe": null,
                    "name": "",
                    "ports": null,
                    "readiness_probe": null,
                    "resources": {
                        "limits": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        },
                        "requests": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        }
                    },
                    "security_context": null,
                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                    "startup_probe": null,
                    "stdin": null,
                    "stdin_once": null,
                    "termination_message_path": null,
                    "termination_message_policy": null,
                    "tty": null,
                    "volume_devices": null,
                    "volume_mounts": null,
                    "working_dir": null
                },
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": [
                    {
                        "effect": "NoSchedule",
                        "key": "nvidia.com/gpu",
                        "operator": "Exists",
                        "toleration_seconds": null,
                        "value": null
                    }
                ],
                "volumes": null
            },
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/lightning-ddp-3": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": null,
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": "00:00:00:30",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "max_time",
                            "value": null,
                            "value_from": null
                        },
                        {
                            "default": "null",
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": null
                        }
                    ]
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": {
                        "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                        "torch-node": "3"
                    }
                },
                "metrics": null,
                "name": "lightning-ddp-3",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "duration",
                            "value": null,
                            "value_from": {
                                "config_map_key_ref": null,
                                "default": null,
                                "event": null,
                                "expression": null,
                                "jq_filter": null,
                                "json_path": null,
                                "parameter": null,
                                "path": "duration",
                                "supplied": null
                            }
                        }
                    ],
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                "priority": null,
                "priority_class_name": null,
                "resource": null,
                "retry_strategy": {
                    "affinity": null,
                    "backoff": null,
                    "expression": null,
                    "limit": "1",
                    "retry_policy": "OnError"
                },
                "scheduler_name": null,
                "script": {
                    "args": null,
                    "command": [
                        "python"
                    ],
                    "env": [
                        {
                            "name": "NCCL_DEBUG",
                            "value": "INFO",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                            "value": "4",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_node_rank",
                            "value": "3",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_start_method",
                            "value": "fork",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                            "value": "static",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                            "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                            "value": "29200",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_run_id",
                            "value": "1",
                            "value_from": null
                        },
                        {
                            "name": "bettmensch_ai_distributed_torch_tee",
                            "value": "0",
                            "value_from": null
                        }
                    ],
                    "env_from": null,
                    "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                    "image_pull_policy": "Always",
                    "lifecycle": null,
                    "liveness_probe": null,
                    "name": "",
                    "ports": null,
                    "readiness_probe": null,
                    "resources": {
                        "limits": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        },
                        "requests": {
                            "cpu": "700m",
                            "memory": "1Gi",
                            "nvidia.com/gpu": "1"
                        }
                    },
                    "security_context": null,
                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                    "startup_probe": null,
                    "stdin": null,
                    "stdin_once": null,
                    "termination_message_path": null,
                    "termination_message_policy": null,
                    "tty": null,
                    "volume_devices": null,
                    "volume_mounts": null,
                    "working_dir": null
                },
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": [
                    {
                        "effect": "NoSchedule",
                        "key": "nvidia.com/gpu",
                        "operator": "Exists",
                        "toleration_seconds": null,
                        "value": null
                    }
                ],
                "volumes": null
            },
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/lightning-ddp-create-torch-service": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": null,
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": null
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": null
                },
                "metrics": null,
                "name": "lightning-ddp-create-torch-service",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": null,
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": null,
                "priority": null,
                "priority_class_name": null,
                "resource": {
                    "action": "create",
                    "failure_condition": null,
                    "flags": null,
                    "manifest": "apiVersion: v1\nkind: Service\nmetadata:\n  name: lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8\n  namespace: argo\n  labels:\n    app: lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8\nspec:\n  clusterIP: None  # ClusterIP set to None for headless service.\n  ports:\n  - name: ddp  # Port for torchrun master<->worker node coms.\n    port: 29200\n    targetPort: 29200\n  selector:\n    torch-job: lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8\n    torch-node: '0'  # Selector for pods associated with this service.\n",
                    "manifest_from": null,
                    "merge_strategy": null,
                    "set_owner_reference": null,
                    "success_condition": null
                },
                "retry_strategy": null,
                "scheduler_name": null,
                "script": null,
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": null,
                "volumes": null
            },
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/lightning-ddp-delete-torch-service": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": null,
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": null
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": null
                },
                "metrics": null,
                "name": "lightning-ddp-delete-torch-service",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": null,
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": null,
                "priority": null,
                "priority_class_name": null,
                "resource": {
                    "action": "delete",
                    "failure_condition": null,
                    "flags": [
                        "service",
                        "--selector",
                        "torch-job=lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                        "-n",
                        "argo"
                    ],
                    "manifest": null,
                    "manifest_from": null,
                    "merge_strategy": null,
                    "set_owner_reference": null,
                    "success_condition": null
                },
                "retry_strategy": null,
                "scheduler_name": null,
                "script": null,
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": null,
                "volumes": null
            },
            "namespaced/pipeline-test-lightning-gpu-pipeline-9r6h2/show-duration-param": {
                "active_deadline_seconds": null,
                "affinity": null,
                "archive_location": null,
                "automount_service_account_token": null,
                "container": null,
                "container_set": null,
                "daemon": null,
                "dag": null,
                "data": null,
                "executor": null,
                "fail_fast": null,
                "host_aliases": null,
                "http": null,
                "init_containers": null,
                "inputs": {
                    "artifacts": null,
                    "parameters": [
                        {
                            "default": null,
                            "description": null,
                            "enum": null,
                            "global_name": null,
                            "name": "a",
                            "value": null,
                            "value_from": null
                        }
                    ]
                },
                "memoize": null,
                "metadata": {
                    "annotations": null,
                    "labels": null
                },
                "metrics": null,
                "name": "show-duration-param",
                "node_selector": null,
                "outputs": {
                    "artifacts": null,
                    "exit_code": null,
                    "parameters": null,
                    "result": null
                },
                "parallelism": null,
                "plugin": null,
                "pod_spec_patch": null,
                "priority": null,
                "priority_class_name": null,
                "resource": null,
                "retry_strategy": {
                    "affinity": null,
                    "backoff": null,
                    "expression": null,
                    "limit": "1",
                    "retry_policy": "OnError"
                },
                "scheduler_name": null,
                "script": {
                    "args": null,
                    "command": [
                        "python"
                    ],
                    "env": null,
                    "env_from": null,
                    "image": "bettmensch88/bettmensch.ai:3.11-latest",
                    "image_pull_policy": "Always",
                    "lifecycle": null,
                    "liveness_probe": null,
                    "name": "",
                    "ports": null,
                    "readiness_probe": null,
                    "resources": {
                        "limits": {
                            "cpu": "100m",
                            "memory": "100Mi"
                        },
                        "requests": {
                            "cpu": "100m",
                            "memory": "100Mi"
                        }
                    },
                    "security_context": null,
                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\ndef show_parameter(a: InputParameter) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputParameter.\"\"\"\n    print(f'Content of input parameter a is: {a}')\nshow_parameter(a)",
                    "startup_probe": null,
                    "stdin": null,
                    "stdin_once": null,
                    "termination_message_path": null,
                    "termination_message_policy": null,
                    "tty": null,
                    "volume_devices": null,
                    "volume_mounts": null,
                    "working_dir": null
                },
                "security_context": null,
                "service_account_name": null,
                "sidecars": null,
                "steps": null,
                "suspend": null,
                "synchronization": null,
                "timeout": null,
                "tolerations": null,
                "volumes": null
            }
        },
        "stored_workflow_template_spec": {
            "active_deadline_seconds": null,
            "affinity": null,
            "archive_logs": null,
            "arguments": {
                "artifacts": null,
                "parameters": [
                    {
                        "default": null,
                        "description": null,
                        "enum": null,
                        "global_name": null,
                        "name": "max_time",
                        "value": "00:00:00:20",
                        "value_from": null
                    }
                ]
            },
            "artifact_gc": null,
            "artifact_repository_ref": null,
            "automount_service_account_token": null,
            "dns_config": null,
            "dns_policy": null,
            "entrypoint": "bettmensch-ai-dag",
            "executor": null,
            "hooks": null,
            "host_aliases": null,
            "host_network": null,
            "image_pull_secrets": null,
            "metrics": null,
            "node_selector": null,
            "on_exit": null,
            "parallelism": null,
            "pod_disruption_budget": null,
            "pod_gc": null,
            "pod_metadata": null,
            "pod_priority": null,
            "pod_priority_class_name": null,
            "pod_spec_patch": null,
            "priority": null,
            "retry_strategy": null,
            "scheduler_name": null,
            "security_context": null,
            "service_account_name": "argo-workflow",
            "shutdown": null,
            "suspend": null,
            "synchronization": null,
            "template_defaults": null,
            "templates": [
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": null,
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": null
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": null
                    },
                    "metrics": null,
                    "name": "lightning-ddp-create-torch-service",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": null,
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": null,
                    "priority": null,
                    "priority_class_name": null,
                    "resource": {
                        "action": "create",
                        "failure_condition": null,
                        "flags": null,
                        "manifest": "apiVersion: v1\nkind: Service\nmetadata:\n  name: lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8\n  namespace: argo\n  labels:\n    app: lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8\nspec:\n  clusterIP: None  # ClusterIP set to None for headless service.\n  ports:\n  - name: ddp  # Port for torchrun master<->worker node coms.\n    port: 29200\n    targetPort: 29200\n  selector:\n    torch-job: lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8\n    torch-node: '0'  # Selector for pods associated with this service.\n",
                        "manifest_from": null,
                        "merge_strategy": null,
                        "set_owner_reference": null,
                        "success_condition": null
                    },
                    "retry_strategy": null,
                    "scheduler_name": null,
                    "script": null,
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": null,
                    "volumes": null
                },
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": null,
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": null
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": null
                    },
                    "metrics": null,
                    "name": "lightning-ddp-delete-torch-service",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": null,
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": null,
                    "priority": null,
                    "priority_class_name": null,
                    "resource": {
                        "action": "delete",
                        "failure_condition": null,
                        "flags": [
                            "service",
                            "--selector",
                            "torch-job=lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                            "-n",
                            "argo"
                        ],
                        "manifest": null,
                        "manifest_from": null,
                        "merge_strategy": null,
                        "set_owner_reference": null,
                        "success_condition": null
                    },
                    "retry_strategy": null,
                    "scheduler_name": null,
                    "script": null,
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": null,
                    "volumes": null
                },
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": {
                        "fail_fast": null,
                        "target": null,
                        "tasks": [
                            {
                                "arguments": {
                                    "artifacts": null,
                                    "parameters": null
                                },
                                "continue_on": null,
                                "dependencies": null,
                                "depends": null,
                                "hooks": null,
                                "inline": null,
                                "name": "lightning-ddp-create-torch-service",
                                "on_exit": null,
                                "template": "lightning-ddp-create-torch-service",
                                "template_ref": null,
                                "when": null,
                                "with_items": null,
                                "with_param": null,
                                "with_sequence": null
                            },
                            {
                                "arguments": {
                                    "artifacts": null,
                                    "parameters": [
                                        {
                                            "default": null,
                                            "description": null,
                                            "enum": null,
                                            "global_name": null,
                                            "name": "max_time",
                                            "value": "{{workflow.parameters.max_time}}",
                                            "value_from": null
                                        }
                                    ]
                                },
                                "continue_on": null,
                                "dependencies": null,
                                "depends": "lightning-ddp-create-torch-service",
                                "hooks": null,
                                "inline": null,
                                "name": "lightning-ddp-0",
                                "on_exit": null,
                                "template": "lightning-ddp-0",
                                "template_ref": null,
                                "when": null,
                                "with_items": null,
                                "with_param": null,
                                "with_sequence": null
                            },
                            {
                                "arguments": {
                                    "artifacts": null,
                                    "parameters": [
                                        {
                                            "default": null,
                                            "description": null,
                                            "enum": null,
                                            "global_name": null,
                                            "name": "max_time",
                                            "value": "{{workflow.parameters.max_time}}",
                                            "value_from": null
                                        }
                                    ]
                                },
                                "continue_on": null,
                                "dependencies": null,
                                "depends": "lightning-ddp-create-torch-service",
                                "hooks": null,
                                "inline": null,
                                "name": "lightning-ddp-0-worker-1",
                                "on_exit": null,
                                "template": "lightning-ddp-1",
                                "template_ref": null,
                                "when": null,
                                "with_items": null,
                                "with_param": null,
                                "with_sequence": null
                            },
                            {
                                "arguments": {
                                    "artifacts": null,
                                    "parameters": [
                                        {
                                            "default": null,
                                            "description": null,
                                            "enum": null,
                                            "global_name": null,
                                            "name": "max_time",
                                            "value": "{{workflow.parameters.max_time}}",
                                            "value_from": null
                                        }
                                    ]
                                },
                                "continue_on": null,
                                "dependencies": null,
                                "depends": "lightning-ddp-create-torch-service",
                                "hooks": null,
                                "inline": null,
                                "name": "lightning-ddp-0-worker-2",
                                "on_exit": null,
                                "template": "lightning-ddp-2",
                                "template_ref": null,
                                "when": null,
                                "with_items": null,
                                "with_param": null,
                                "with_sequence": null
                            },
                            {
                                "arguments": {
                                    "artifacts": null,
                                    "parameters": [
                                        {
                                            "default": null,
                                            "description": null,
                                            "enum": null,
                                            "global_name": null,
                                            "name": "max_time",
                                            "value": "{{workflow.parameters.max_time}}",
                                            "value_from": null
                                        }
                                    ]
                                },
                                "continue_on": null,
                                "dependencies": null,
                                "depends": "lightning-ddp-create-torch-service",
                                "hooks": null,
                                "inline": null,
                                "name": "lightning-ddp-0-worker-3",
                                "on_exit": null,
                                "template": "lightning-ddp-3",
                                "template_ref": null,
                                "when": null,
                                "with_items": null,
                                "with_param": null,
                                "with_sequence": null
                            },
                            {
                                "arguments": {
                                    "artifacts": null,
                                    "parameters": null
                                },
                                "continue_on": null,
                                "dependencies": null,
                                "depends": "lightning-ddp-0",
                                "hooks": null,
                                "inline": null,
                                "name": "lightning-ddp-delete-torch-service",
                                "on_exit": null,
                                "template": "lightning-ddp-delete-torch-service",
                                "template_ref": null,
                                "when": null,
                                "with_items": null,
                                "with_param": null,
                                "with_sequence": null
                            },
                            {
                                "arguments": {
                                    "artifacts": null,
                                    "parameters": [
                                        {
                                            "default": null,
                                            "description": null,
                                            "enum": null,
                                            "global_name": null,
                                            "name": "a",
                                            "value": "{{tasks.lightning-ddp-0.outputs.parameters.duration}}",
                                            "value_from": null
                                        }
                                    ]
                                },
                                "continue_on": null,
                                "dependencies": null,
                                "depends": "lightning-ddp-0",
                                "hooks": null,
                                "inline": null,
                                "name": "show-duration-param-0",
                                "on_exit": null,
                                "template": "show-duration-param",
                                "template_ref": null,
                                "when": null,
                                "with_items": null,
                                "with_param": null,
                                "with_sequence": null
                            }
                        ]
                    },
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": null
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": null
                    },
                    "metrics": null,
                    "name": "bettmensch-ai-dag",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": null,
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": null,
                    "priority": null,
                    "priority_class_name": null,
                    "resource": null,
                    "retry_strategy": null,
                    "scheduler_name": null,
                    "script": null,
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": null,
                    "volumes": null
                },
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": null,
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": [
                            {
                                "default": "00:00:00:30",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "max_time",
                                "value": null,
                                "value_from": null
                            },
                            {
                                "default": "null",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": null
                            }
                        ]
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": {
                            "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                            "torch-node": "0"
                        }
                    },
                    "metrics": null,
                    "name": "lightning-ddp-0",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": [
                            {
                                "default": null,
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": {
                                    "config_map_key_ref": null,
                                    "default": null,
                                    "event": null,
                                    "expression": null,
                                    "jq_filter": null,
                                    "json_path": null,
                                    "parameter": null,
                                    "path": "duration",
                                    "supplied": null
                                }
                            }
                        ],
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                    "priority": null,
                    "priority_class_name": null,
                    "resource": null,
                    "retry_strategy": {
                        "affinity": null,
                        "backoff": null,
                        "expression": null,
                        "limit": "1",
                        "retry_policy": "OnError"
                    },
                    "scheduler_name": null,
                    "script": {
                        "args": null,
                        "command": [
                            "python"
                        ],
                        "env": [
                            {
                                "name": "NCCL_DEBUG",
                                "value": "INFO",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_min_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_node_rank",
                                "value": "0",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_restarts",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_start_method",
                                "value": "fork",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                "value": "static",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                "value": "29200",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_run_id",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_tee",
                                "value": "0",
                                "value_from": null
                            }
                        ],
                        "env_from": null,
                        "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                        "image_pull_policy": "Always",
                        "lifecycle": null,
                        "liveness_probe": null,
                        "name": "",
                        "ports": [
                            {
                                "container_port": 29200,
                                "host_ip": null,
                                "host_port": null,
                                "name": "ddp",
                                "protocol": "TCP"
                            }
                        ],
                        "readiness_probe": null,
                        "resources": {
                            "limits": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            },
                            "requests": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            }
                        },
                        "security_context": null,
                        "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                        "startup_probe": null,
                        "stdin": null,
                        "stdin_once": null,
                        "termination_message_path": null,
                        "termination_message_policy": null,
                        "tty": null,
                        "volume_devices": null,
                        "volume_mounts": null,
                        "working_dir": null
                    },
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": [
                        {
                            "effect": "NoSchedule",
                            "key": "nvidia.com/gpu",
                            "operator": "Exists",
                            "toleration_seconds": null,
                            "value": null
                        }
                    ],
                    "volumes": null
                },
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": null,
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": [
                            {
                                "default": "00:00:00:30",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "max_time",
                                "value": null,
                                "value_from": null
                            },
                            {
                                "default": "null",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": null
                            }
                        ]
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": {
                            "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                            "torch-node": "1"
                        }
                    },
                    "metrics": null,
                    "name": "lightning-ddp-1",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": [
                            {
                                "default": null,
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": {
                                    "config_map_key_ref": null,
                                    "default": null,
                                    "event": null,
                                    "expression": null,
                                    "jq_filter": null,
                                    "json_path": null,
                                    "parameter": null,
                                    "path": "duration",
                                    "supplied": null
                                }
                            }
                        ],
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                    "priority": null,
                    "priority_class_name": null,
                    "resource": null,
                    "retry_strategy": {
                        "affinity": null,
                        "backoff": null,
                        "expression": null,
                        "limit": "1",
                        "retry_policy": "OnError"
                    },
                    "scheduler_name": null,
                    "script": {
                        "args": null,
                        "command": [
                            "python"
                        ],
                        "env": [
                            {
                                "name": "NCCL_DEBUG",
                                "value": "INFO",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_min_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_node_rank",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_restarts",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_start_method",
                                "value": "fork",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                "value": "static",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                "value": "29200",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_run_id",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_tee",
                                "value": "0",
                                "value_from": null
                            }
                        ],
                        "env_from": null,
                        "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                        "image_pull_policy": "Always",
                        "lifecycle": null,
                        "liveness_probe": null,
                        "name": "",
                        "ports": null,
                        "readiness_probe": null,
                        "resources": {
                            "limits": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            },
                            "requests": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            }
                        },
                        "security_context": null,
                        "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                        "startup_probe": null,
                        "stdin": null,
                        "stdin_once": null,
                        "termination_message_path": null,
                        "termination_message_policy": null,
                        "tty": null,
                        "volume_devices": null,
                        "volume_mounts": null,
                        "working_dir": null
                    },
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": [
                        {
                            "effect": "NoSchedule",
                            "key": "nvidia.com/gpu",
                            "operator": "Exists",
                            "toleration_seconds": null,
                            "value": null
                        }
                    ],
                    "volumes": null
                },
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": null,
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": [
                            {
                                "default": "00:00:00:30",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "max_time",
                                "value": null,
                                "value_from": null
                            },
                            {
                                "default": "null",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": null
                            }
                        ]
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": {
                            "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                            "torch-node": "2"
                        }
                    },
                    "metrics": null,
                    "name": "lightning-ddp-2",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": [
                            {
                                "default": null,
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": {
                                    "config_map_key_ref": null,
                                    "default": null,
                                    "event": null,
                                    "expression": null,
                                    "jq_filter": null,
                                    "json_path": null,
                                    "parameter": null,
                                    "path": "duration",
                                    "supplied": null
                                }
                            }
                        ],
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                    "priority": null,
                    "priority_class_name": null,
                    "resource": null,
                    "retry_strategy": {
                        "affinity": null,
                        "backoff": null,
                        "expression": null,
                        "limit": "1",
                        "retry_policy": "OnError"
                    },
                    "scheduler_name": null,
                    "script": {
                        "args": null,
                        "command": [
                            "python"
                        ],
                        "env": [
                            {
                                "name": "NCCL_DEBUG",
                                "value": "INFO",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_min_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_node_rank",
                                "value": "2",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_restarts",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_start_method",
                                "value": "fork",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                "value": "static",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                "value": "29200",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_run_id",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_tee",
                                "value": "0",
                                "value_from": null
                            }
                        ],
                        "env_from": null,
                        "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                        "image_pull_policy": "Always",
                        "lifecycle": null,
                        "liveness_probe": null,
                        "name": "",
                        "ports": null,
                        "readiness_probe": null,
                        "resources": {
                            "limits": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            },
                            "requests": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            }
                        },
                        "security_context": null,
                        "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                        "startup_probe": null,
                        "stdin": null,
                        "stdin_once": null,
                        "termination_message_path": null,
                        "termination_message_policy": null,
                        "tty": null,
                        "volume_devices": null,
                        "volume_mounts": null,
                        "working_dir": null
                    },
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": [
                        {
                            "effect": "NoSchedule",
                            "key": "nvidia.com/gpu",
                            "operator": "Exists",
                            "toleration_seconds": null,
                            "value": null
                        }
                    ],
                    "volumes": null
                },
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": null,
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": [
                            {
                                "default": "00:00:00:30",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "max_time",
                                "value": null,
                                "value_from": null
                            },
                            {
                                "default": "null",
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": null
                            }
                        ]
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": {
                            "torch-job": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8",
                            "torch-node": "3"
                        }
                    },
                    "metrics": null,
                    "name": "lightning-ddp-3",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": [
                            {
                                "default": null,
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "duration",
                                "value": null,
                                "value_from": {
                                    "config_map_key_ref": null,
                                    "default": null,
                                    "event": null,
                                    "expression": null,
                                    "jq_filter": null,
                                    "json_path": null,
                                    "parameter": null,
                                    "path": "duration",
                                    "supplied": null
                                }
                            }
                        ],
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                    "priority": null,
                    "priority_class_name": null,
                    "resource": null,
                    "retry_strategy": {
                        "affinity": null,
                        "backoff": null,
                        "expression": null,
                        "limit": "1",
                        "retry_policy": "OnError"
                    },
                    "scheduler_name": null,
                    "script": {
                        "args": null,
                        "command": [
                            "python"
                        ],
                        "env": [
                            {
                                "name": "NCCL_DEBUG",
                                "value": "INFO",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_min_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_nodes",
                                "value": "4",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_node_rank",
                                "value": "3",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_max_restarts",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_start_method",
                                "value": "fork",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                "value": "static",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                "value": "lightning-ddp-0-3278f52c-b445-42e4-8e6e-ad2e351afcc8.argo.svc.cluster.local",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                "value": "29200",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_run_id",
                                "value": "1",
                                "value_from": null
                            },
                            {
                                "name": "bettmensch_ai_distributed_torch_tee",
                                "value": "0",
                                "value_from": null
                            }
                        ],
                        "env_from": null,
                        "image": "bettmensch88/bettmensch.ai-lightning:3.11-latest",
                        "image_pull_policy": "Always",
                        "lifecycle": null,
                        "liveness_probe": null,
                        "name": "",
                        "ports": null,
                        "readiness_probe": null,
                        "resources": {
                            "limits": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            },
                            "requests": {
                                "cpu": "700m",
                                "memory": "1Gi",
                                "nvidia.com/gpu": "1"
                            }
                        },
                        "security_context": null,
                        "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: max_time = json.loads(r'''{{inputs.parameters.max_time}}''')\nexcept: max_time = r'''{{inputs.parameters.max_time}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef lightning_ddp(max_time: InputParameter='00:00:00:30', duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    from datetime import datetime as dt\n    import lightning.pytorch as pl\n    import torch\n    from bettmensch_ai.components.torch_utils import LaunchConfigSettings\n    from lightning.pytorch.strategies import DDPStrategy\n    start = dt.now()\n\n    class ToyExample(pl.LightningModule):\n\n        def __init__(self, model):\n            super().__init__()\n            self.model = model\n\n        def training_step(self, batch):\n            loss = self.model(batch).sum()\n            return loss\n\n        def configure_optimizers(self):\n            return torch.optim.Adam(self.model.parameters())\n    model = torch.nn.Linear(32, 2)\n    pl_module = ToyExample(model)\n    train_dataloader = torch.utils.data.DataLoader(torch.randn(8, 32))\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    process_group_backend = 'nccl' if has_gpu else 'gloo'\n    accelerator = 'gpu' if has_gpu else 'cpu'\n    ddp = DDPStrategy(process_group_backend=process_group_backend)\n    launch_settings = LaunchConfigSettings()\n    trainer = pl.Trainer(strategy=ddp, accelerator=accelerator, num_nodes=launch_settings.max_nodes, devices=launch_settings.nproc_per_node, max_time=max_time)\n    trainer.fit(pl_module, train_dataloader)\n    if duration is not None:\n        duration.assign(dt.now() - start)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(lightning_ddp)\n\ntorch_distributed_function(max_time,duration)",
                        "startup_probe": null,
                        "stdin": null,
                        "stdin_once": null,
                        "termination_message_path": null,
                        "termination_message_policy": null,
                        "tty": null,
                        "volume_devices": null,
                        "volume_mounts": null,
                        "working_dir": null
                    },
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": [
                        {
                            "effect": "NoSchedule",
                            "key": "nvidia.com/gpu",
                            "operator": "Exists",
                            "toleration_seconds": null,
                            "value": null
                        }
                    ],
                    "volumes": null
                },
                {
                    "active_deadline_seconds": null,
                    "affinity": null,
                    "archive_location": null,
                    "automount_service_account_token": null,
                    "container": null,
                    "container_set": null,
                    "daemon": null,
                    "dag": null,
                    "data": null,
                    "executor": null,
                    "fail_fast": null,
                    "host_aliases": null,
                    "http": null,
                    "init_containers": null,
                    "inputs": {
                        "artifacts": null,
                        "parameters": [
                            {
                                "default": null,
                                "description": null,
                                "enum": null,
                                "global_name": null,
                                "name": "a",
                                "value": null,
                                "value_from": null
                            }
                        ]
                    },
                    "memoize": null,
                    "metadata": {
                        "annotations": null,
                        "labels": null
                    },
                    "metrics": null,
                    "name": "show-duration-param",
                    "node_selector": null,
                    "outputs": {
                        "artifacts": null,
                        "exit_code": null,
                        "parameters": null,
                        "result": null
                    },
                    "parallelism": null,
                    "plugin": null,
                    "pod_spec_patch": null,
                    "priority": null,
                    "priority_class_name": null,
                    "resource": null,
                    "retry_strategy": {
                        "affinity": null,
                        "backoff": null,
                        "expression": null,
                        "limit": "1",
                        "retry_policy": "OnError"
                    },
                    "scheduler_name": null,
                    "script": {
                        "args": null,
                        "command": [
                            "python"
                        ],
                        "env": null,
                        "env_from": null,
                        "image": "bettmensch88/bettmensch.ai:3.11-latest",
                        "image_pull_policy": "Always",
                        "lifecycle": null,
                        "liveness_probe": null,
                        "name": "",
                        "ports": null,
                        "readiness_probe": null,
                        "resources": {
                            "limits": {
                                "cpu": "100m",
                                "memory": "100Mi"
                            },
                            "requests": {
                                "cpu": "100m",
                                "memory": "100Mi"
                            }
                        },
                        "security_context": null,
                        "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\ndef show_parameter(a: InputParameter) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputParameter.\"\"\"\n    print(f'Content of input parameter a is: {a}')\nshow_parameter(a)",
                        "startup_probe": null,
                        "stdin": null,
                        "stdin_once": null,
                        "termination_message_path": null,
                        "termination_message_policy": null,
                        "tty": null,
                        "volume_devices": null,
                        "volume_mounts": null,
                        "working_dir": null
                    },
                    "security_context": null,
                    "service_account_name": null,
                    "sidecars": null,
                    "steps": null,
                    "suspend": null,
                    "synchronization": null,
                    "timeout": null,
                    "tolerations": null,
                    "volumes": null
                }
            ],
            "tolerations": null,
            "ttl_strategy": null,
            "volume_claim_gc": null,
            "volume_claim_templates": null,
            "volumes": null,
            "workflow_metadata": null,
            "workflow_template_ref": {
                "cluster_scope": null,
                "name": "pipeline-test-lightning-gpu-pipeline-9r6h2"
            }
        },
        "synchronization": null,
        "task_results_completion_status": {
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1639120660": true,
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1697154233": true,
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-1820439476": true,
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-2871044736": true,
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3164367506": true,
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-3295920951": true,
            "pipeline-test-lightning-gpu-pipeline-9r6h2-flow-c7v5d-966953919": true
        }
    }
}