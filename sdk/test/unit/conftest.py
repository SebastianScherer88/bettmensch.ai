import datetime
import os
from typing import Callable, List

import pytest
from bettmensch_ai.pipelines.constants import ResourceType
from bettmensch_ai.pipelines.io import (
    InputArtifact,
    InputParameter,
    OutputArtifact,
    OutputParameter,
)
from pydantic import BaseModel


@pytest.fixture
def test_output_dir():
    return os.path.join(".", "sdk", "test", "unit", "outputs")


@pytest.fixture
def test_mock_pipeline():
    class MockPipeline:
        type = ResourceType.pipeline.value
        io_owner_name = ResourceType.pipeline.value

    return MockPipeline()


@pytest.fixture
def test_mock_component():
    class MockComponent:
        type = ResourceType.component.value
        name = "mock-component-0"
        io_owner_name = f"{type}.{name}"

    return MockComponent()


@pytest.fixture
def test_mock_script(test_function_and_task_inputs):
    test_function, _ = test_function_and_task_inputs

    class MockArgument(BaseModel):
        name: str

    class MockIO(BaseModel):
        parameters: List[MockArgument]
        artifacts: List[MockArgument]

    class MockScript:
        source: Callable = test_function
        add_cwd_to_sys_path: bool = False

        def _build_inputs(self):

            return MockIO(
                parameters=[
                    MockArgument(name="a"),
                    MockArgument(name="b"),
                    MockArgument(name="c"),
                ],
                artifacts=[MockArgument(name="d")],
            )

        def _build_outputs(self):

            return MockIO(
                parameters=[MockArgument(name="a_out")],
                artifacts=[MockArgument(name="b_out")],
            )

    return MockScript()


@pytest.fixture
def test_function_and_task_inputs(test_mock_pipeline, test_mock_component):
    def test_function(
        a: InputParameter,
        b: InputParameter,
        c: InputParameter,
        d: InputArtifact,
        a_out: OutputParameter,
        b_out: OutputArtifact,
    ):
        pass

    test_input_a = InputParameter("fixed", 1)
    test_input_b = InputParameter("mock_pipe_in", 1)
    test_input_b.set_owner(test_mock_pipeline)
    test_input_c = OutputParameter("mock_comp_out_param")
    test_input_c.set_owner(test_mock_component)
    test_input_d = OutputArtifact("mock_comp_out_art")
    test_input_d.set_owner(test_mock_component)

    task_inputs = {
        "a": test_input_a,
        "b": test_input_b,
        "c": test_input_c,
        "d": test_input_d,
    }

    return test_function, task_inputs


@pytest.fixture
def test_hera_artifact_workflow_template_model():
    class MockHeraWorkflowTemplateModel:
        def dict(self):

            return {
                "api_version": None,
                "kind": None,
                "metadata": {
                    "annotations": None,
                    "cluster_name": None,
                    "creation_timestamp": datetime.datetime(2024, 12, 8),
                    "deletion_grace_period_seconds": None,
                    "deletion_timestamp": None,
                    "finalizers": None,
                    "generate_name": "pipeline-test-artifact-pipeline-",
                    "generation": 1,
                    "labels": {
                        "workflows.argoproj.io/creator": "system-serviceaccount-argo-argo-server"
                    },
                    "managed_fields": [
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "argo",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2024, 12, 8),
                        }
                    ],
                    "name": "pipeline-test-artifact-pipeline-d5rzf",
                    "namespace": "argo",
                    "owner_references": None,
                    "resource_version": "9057",
                    "self_link": None,
                    "uid": "310b62f6-95fb-418f-ab28-e7070b183979",
                },
                "spec": {
                    "active_deadline_seconds": None,
                    "affinity": None,
                    "archive_logs": None,
                    "arguments": {
                        "artifacts": None,
                        "parameters": [
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "a",
                                "value": "Param A",
                                "value_from": None,
                            }
                        ],
                    },
                    "artifact_gc": None,
                    "artifact_repository_ref": None,
                    "automount_service_account_token": None,
                    "dns_config": None,
                    "dns_policy": None,
                    "entrypoint": "bettmensch-ai-dag",
                    "executor": None,
                    "hooks": None,
                    "host_aliases": None,
                    "host_network": None,
                    "image_pull_secrets": None,
                    "metrics": None,
                    "node_selector": None,
                    "on_exit": None,
                    "parallelism": None,
                    "pod_disruption_budget": None,
                    "pod_gc": None,
                    "pod_metadata": None,
                    "pod_priority": None,
                    "pod_priority_class_name": None,
                    "pod_spec_patch": None,
                    "priority": None,
                    "retry_strategy": None,
                    "scheduler_name": None,
                    "security_context": None,
                    "service_account_name": None,
                    "shutdown": None,
                    "suspend": None,
                    "synchronization": None,
                    "template_defaults": None,
                    "templates": [
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": {
                                "fail_fast": None,
                                "target": None,
                                "tasks": [
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{workflow.parameters.a}}",
                                                    "value_from": None,
                                                }
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": None,
                                        "hooks": None,
                                        "inline": None,
                                        "name": "convert-to-artifact-0",
                                        "on_exit": None,
                                        "template": "convert-to-artifact",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": [
                                                {
                                                    "archive": None,
                                                    "archive_logs": None,
                                                    "artifact_gc": None,
                                                    "artifactory": None,
                                                    "azure": None,
                                                    "deleted": None,
                                                    "from_": "{{tasks.convert-to-artifact-0.outputs.artifacts.a_art}}",
                                                    "from_expression": None,
                                                    "gcs": None,
                                                    "git": None,
                                                    "global_name": None,
                                                    "hdfs": None,
                                                    "http": None,
                                                    "mode": None,
                                                    "name": "a",
                                                    "optional": None,
                                                    "oss": None,
                                                    "path": None,
                                                    "raw": None,
                                                    "recurse_mode": None,
                                                    "s3": None,
                                                    "sub_path": None,
                                                }
                                            ],
                                            "parameters": None,
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "convert-to-artifact-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "show-artifact-0",
                                        "on_exit": None,
                                        "template": "show-artifact",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                ],
                            },
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "bettmensch-ai-dag",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a_art",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "convert-to-artifact",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a_art",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a_art",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": None,
                                        "sub_path": None,
                                    }
                                ],
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputArtifact\na_art = OutputArtifact(\"a_art\")\n\ndef convert_to_artifact(a: InputParameter, a_art: OutputArtifact=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that converts its InputParameter into\n    an OutputArtifact.\"\"\"\n    with open(a_art.path, 'w') as a_art_file:\n        a_art_file.write(str(a))\nconvert_to_artifact(a,a_art)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": None,
                                        "sub_path": None,
                                    }
                                ],
                                "parameters": None,
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "show-artifact",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": 'import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\n\nfrom bettmensch_ai.io import InputArtifact\na = InputArtifact("a")\n\ndef show_artifact(a: InputArtifact) -> None:\n    """When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputArtifact."""\n    with open(a.path, \'r\') as a_art_file:\n        a_content = a_art_file.read()\n    print(f\'Content of input artifact a: {a_content}\')\nshow_artifact(a)',
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                    ],
                    "tolerations": None,
                    "ttl_strategy": None,
                    "volume_claim_gc": None,
                    "volume_claim_templates": None,
                    "volumes": None,
                    "workflow_metadata": None,
                    "workflow_template_ref": None,
                },
            }

    return MockHeraWorkflowTemplateModel()


@pytest.fixture
def test_hera_parameter_workflow_template_model():
    class MockHeraWorkflowTemplateModel:
        def dict(self):

            return {
                "api_version": None,
                "kind": None,
                "metadata": {
                    "annotations": None,
                    "cluster_name": None,
                    "creation_timestamp": datetime.datetime(2024, 8, 12),
                    "deletion_grace_period_seconds": None,
                    "deletion_timestamp": None,
                    "finalizers": None,
                    "generate_name": "pipeline-test-parameter-pipeline-",
                    "generation": 1,
                    "labels": {
                        "workflows.argoproj.io/creator": "system-serviceaccount-argo-argo-server"
                    },
                    "managed_fields": [
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "argo",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2024, 8, 12),
                        }
                    ],
                    "name": "pipeline-test-parameter-pipeline-mhwgd",
                    "namespace": "argo",
                    "owner_references": None,
                    "resource_version": "9922",
                    "self_link": None,
                    "uid": "eb9cff7d-b949-4aa9-9cf6-703b2a602128",
                },
                "spec": {
                    "active_deadline_seconds": None,
                    "affinity": None,
                    "archive_logs": None,
                    "arguments": {
                        "artifacts": None,
                        "parameters": [
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "a",
                                "value": "1",
                                "value_from": None,
                            },
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "b",
                                "value": "2",
                                "value_from": None,
                            },
                        ],
                    },
                    "artifact_gc": None,
                    "artifact_repository_ref": None,
                    "automount_service_account_token": None,
                    "dns_config": None,
                    "dns_policy": None,
                    "entrypoint": "bettmensch-ai-dag",
                    "executor": None,
                    "hooks": None,
                    "host_aliases": None,
                    "host_network": None,
                    "image_pull_secrets": None,
                    "metrics": None,
                    "node_selector": None,
                    "on_exit": None,
                    "parallelism": None,
                    "pod_disruption_budget": None,
                    "pod_gc": None,
                    "pod_metadata": None,
                    "pod_priority": None,
                    "pod_priority_class_name": None,
                    "pod_spec_patch": None,
                    "priority": None,
                    "retry_strategy": None,
                    "scheduler_name": None,
                    "security_context": None,
                    "service_account_name": None,
                    "shutdown": None,
                    "suspend": None,
                    "synchronization": None,
                    "template_defaults": None,
                    "templates": [
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": {
                                "fail_fast": None,
                                "target": None,
                                "tasks": [
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{workflow.parameters.a}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "b",
                                                    "value": "{{workflow.parameters.b}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": None,
                                        "hooks": None,
                                        "inline": None,
                                        "name": "a-plus-b-0",
                                        "on_exit": None,
                                        "template": "a-plus-b",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{tasks.a-plus-b-0.outputs.parameters.sum}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "b",
                                                    "value": "2",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "a-plus-b-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "a-plus-b-plus-2-0",
                                        "on_exit": None,
                                        "template": "a-plus-b-plus-2",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                ],
                            },
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "bettmensch-ai-dag",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "a-plus-b",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\ntry: b = json.loads(r'''{{inputs.parameters.b}}''')\nexcept: b = r'''{{inputs.parameters.b}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nsum = OutputParameter(\"sum\")\n\ndef add_parameters(a: InputParameter=1, b: InputParameter=2, sum: OutputParameter=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a simple addition bettmensch_ai.Component.\"\"\"\n    sum.assign(a + b)\nadd_parameters(a,b,sum)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "a-plus-b-plus-2",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\ntry: b = json.loads(r'''{{inputs.parameters.b}}''')\nexcept: b = r'''{{inputs.parameters.b}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nsum = OutputParameter(\"sum\")\n\ndef add_parameters(a: InputParameter=1, b: InputParameter=2, sum: OutputParameter=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a simple addition bettmensch_ai.Component.\"\"\"\n    sum.assign(a + b)\nadd_parameters(a,b,sum)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                    ],
                    "tolerations": None,
                    "ttl_strategy": None,
                    "volume_claim_gc": None,
                    "volume_claim_templates": None,
                    "volumes": None,
                    "workflow_metadata": None,
                    "workflow_template_ref": None,
                },
            }

    return MockHeraWorkflowTemplateModel()


@pytest.fixture
def test_hera_torch_gpu_workflow_template_model():
    class MockHeraWorkflowTemplateModel:
        def dict(self):

            return {
                "api_version": None,
                "kind": None,
                "metadata": {
                    "annotations": None,
                    "cluster_name": None,
                    "creation_timestamp": datetime.datetime(2024, 8, 12),
                    "deletion_grace_period_seconds": None,
                    "deletion_timestamp": None,
                    "finalizers": None,
                    "generate_name": "pipeline-test-torch-gpu-pipeline-",
                    "generation": 1,
                    "labels": {
                        "workflows.argoproj.io/creator": "system-serviceaccount-argo-argo-server"
                    },
                    "managed_fields": [
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "argo",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2024, 8, 12),
                        }
                    ],
                    "name": "pipeline-test-torch-gpu-pipeline-dcfq8",
                    "namespace": "argo",
                    "owner_references": None,
                    "resource_version": "11645",
                    "self_link": None,
                    "uid": "1527e48c-6646-4cc4-8a54-edd274467a44",
                },
                "spec": {
                    "active_deadline_seconds": None,
                    "affinity": None,
                    "archive_logs": None,
                    "arguments": {
                        "artifacts": None,
                        "parameters": [
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "n_iter",
                                "value": "None",
                                "value_from": None,
                            },
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "n_seconds_sleep",
                                "value": "None",
                                "value_from": None,
                            },
                        ],
                    },
                    "artifact_gc": None,
                    "artifact_repository_ref": None,
                    "automount_service_account_token": None,
                    "dns_config": None,
                    "dns_policy": None,
                    "entrypoint": "bettmensch-ai-dag",
                    "executor": None,
                    "hooks": None,
                    "host_aliases": None,
                    "host_network": None,
                    "image_pull_secrets": None,
                    "metrics": None,
                    "node_selector": None,
                    "on_exit": None,
                    "parallelism": None,
                    "pod_disruption_budget": None,
                    "pod_gc": None,
                    "pod_metadata": None,
                    "pod_priority": None,
                    "pod_priority_class_name": None,
                    "pod_spec_patch": None,
                    "priority": None,
                    "retry_strategy": None,
                    "scheduler_name": None,
                    "security_context": None,
                    "service_account_name": None,
                    "shutdown": None,
                    "suspend": None,
                    "synchronization": None,
                    "template_defaults": None,
                    "templates": [
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "torch-ddp-create-torch-service",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": {
                                "action": "create",
                                "failure_condition": None,
                                "flags": None,
                                "manifest": "apiVersion: v1\nkind: Service\nmetadata:\n  name: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\n  namespace: argo\n  labels:\n    app: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\nspec:\n  clusterIP: None  # ClusterIP set to None for headless service.\n  ports:\n  - name: ddp  # Port for torchrun master<->worker node coms.\n    port: 29200\n    targetPort: 29200\n  selector:\n    torch-job: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\n    torch-node: '0'  # Selector for pods associated with this service.\n",
                                "manifest_from": None,
                                "merge_strategy": None,
                                "set_owner_reference": None,
                                "success_condition": None,
                            },
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "torch-ddp-delete-torch-service",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": {
                                "action": "delete",
                                "failure_condition": None,
                                "flags": [
                                    "service",
                                    "--selector",
                                    "torch-job=torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "-n",
                                    "argo",
                                ],
                                "manifest": None,
                                "manifest_from": None,
                                "merge_strategy": None,
                                "set_owner_reference": None,
                                "success_condition": None,
                            },
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": {
                                "fail_fast": None,
                                "target": None,
                                "tasks": [
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": None,
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": None,
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-create-torch-service",
                                        "on_exit": None,
                                        "template": "torch-ddp-create-torch-service",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0",
                                        "on_exit": None,
                                        "template": "torch-ddp-0",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0-worker-1",
                                        "on_exit": None,
                                        "template": "torch-ddp-1",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0-worker-2",
                                        "on_exit": None,
                                        "template": "torch-ddp-2",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0-worker-3",
                                        "on_exit": None,
                                        "template": "torch-ddp-3",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": None,
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-delete-torch-service",
                                        "on_exit": None,
                                        "template": "torch-ddp-delete-torch-service",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{tasks.torch-ddp-0.outputs.parameters.duration}}",
                                                    "value_from": None,
                                                }
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "show-duration-param-0",
                                        "on_exit": None,
                                        "template": "show-duration-param",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                ],
                            },
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "bettmensch-ai-dag",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "0",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-0",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": [
                                    {
                                        "container_port": 29200,
                                        "host_ip": None,
                                        "host_port": None,
                                        "name": "ddp",
                                        "protocol": "TCP",
                                    }
                                ],
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "1",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-1",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "2",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-2",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "2",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "3",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-3",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "3",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    }
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "show-duration-param",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\ndef show_parameter(a: InputParameter) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputParameter.\"\"\"\n    print(f'Content of input parameter a is: {a}')\nshow_parameter(a)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                    ],
                    "tolerations": None,
                    "ttl_strategy": None,
                    "volume_claim_gc": None,
                    "volume_claim_templates": None,
                    "volumes": None,
                    "workflow_metadata": None,
                    "workflow_template_ref": None,
                },
            }

    return MockHeraWorkflowTemplateModel()


@pytest.fixture
def test_hera_artifact_workflow_model():
    class MockHeraWorkflowModel:
        def dict(self):

            return {
                "api_version": None,
                "kind": None,
                "metadata": {
                    "annotations": {
                        "karpenter.sh/do-not-disrupt": "True",
                        "workflows.argoproj.io/pod-name-format": "v2",
                    },
                    "cluster_name": None,
                    "creation_timestamp": datetime.datetime(2022, 11, 8),
                    "deletion_grace_period_seconds": None,
                    "deletion_timestamp": None,
                    "finalizers": None,
                    "generate_name": "pipeline-test-artifact-pipeline-d5rzf-flow-",
                    "generation": 6,
                    "labels": {
                        "workflows.argoproj.io/completed": "True",
                        "workflows.argoproj.io/creator": "system-serviceaccount-argo-argo-server",
                        "workflows.argoproj.io/phase": "Succeeded",
                    },
                    "managed_fields": [
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "argo",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2022, 11, 8),
                        },
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "workflow-controller",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2022, 11, 8),
                        },
                    ],
                    "name": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                    "namespace": "argo",
                    "owner_references": None,
                    "resource_version": "18180",
                    "self_link": None,
                    "uid": "dc477fa6-dd12-43b7-8511-e3dc03bf023c",
                },
                "spec": {
                    "active_deadline_seconds": None,
                    "affinity": None,
                    "archive_logs": None,
                    "arguments": {
                        "artifacts": None,
                        "parameters": [
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "a",
                                "value": "Second integration test value a",
                                "value_from": None,
                            }
                        ],
                    },
                    "artifact_gc": None,
                    "artifact_repository_ref": None,
                    "automount_service_account_token": None,
                    "dns_config": None,
                    "dns_policy": None,
                    "entrypoint": None,
                    "executor": None,
                    "hooks": None,
                    "host_aliases": None,
                    "host_network": None,
                    "image_pull_secrets": None,
                    "metrics": None,
                    "node_selector": None,
                    "on_exit": None,
                    "parallelism": None,
                    "pod_disruption_budget": None,
                    "pod_gc": None,
                    "pod_metadata": None,
                    "pod_priority": None,
                    "pod_priority_class_name": None,
                    "pod_spec_patch": None,
                    "priority": None,
                    "retry_strategy": None,
                    "scheduler_name": None,
                    "security_context": None,
                    "service_account_name": None,
                    "shutdown": None,
                    "suspend": None,
                    "synchronization": None,
                    "template_defaults": None,
                    "templates": None,
                    "tolerations": None,
                    "ttl_strategy": None,
                    "volume_claim_gc": None,
                    "volume_claim_templates": None,
                    "volumes": None,
                    "workflow_metadata": None,
                    "workflow_template_ref": {
                        "cluster_scope": None,
                        "name": "pipeline-test-artifact-pipeline-d5rzf",
                    },
                },
                "status": {
                    "artifact_gc_status": {
                        "not_specified": True,
                        "pods_recouped": None,
                        "strategies_processed": None,
                    },
                    "artifact_repository_ref": {
                        "artifact_repository": {
                            "archive_logs": None,
                            "artifactory": None,
                            "azure": None,
                            "gcs": None,
                            "hdfs": None,
                            "oss": None,
                            "s3": {
                                "access_key_secret": None,
                                "bucket": "bettmensch-ai-artifact-repository",
                                "ca_secret": None,
                                "create_bucket_if_not_present": None,
                                "encryption_options": None,
                                "endpoint": "s3.us-east-2.amazonaws.com",
                                "insecure": True,
                                "key_format": None,
                                "key_prefix": None,
                                "region": None,
                                "role_arn": None,
                                "secret_key_secret": None,
                                "use_sdk_creds": None,
                            },
                        },
                        "config_map": "artifact-repositories",
                        "default": None,
                        "key": "bettmensch-ai-artifact-repository",
                        "namespace": "argo",
                    },
                    "compressed_nodes": None,
                    "conditions": [
                        {
                            "message": None,
                            "status": "False",
                            "type": "PodRunning",
                        },
                        {
                            "message": None,
                            "status": "True",
                            "type": "Completed",
                        },
                    ],
                    "estimated_duration": None,
                    "finished_at": datetime.datetime(2022, 11, 8),
                    "message": None,
                    "nodes": {
                        "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9": {
                            "boundary_id": None,
                            "children": [
                                "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-3688018393"
                            ],
                            "daemoned": None,
                            "display_name": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                            "inputs": None,
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                            "node_flag": None,
                            "outbound_nodes": [
                                "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-2313483554"
                            ],
                            "outputs": None,
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "2/2",
                            "resources_duration": {"cpu": 2, "memory": 48},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "bettmensch-ai-dag",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "DAG",
                        },
                        "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-1037491743": {
                            "boundary_id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                            "children": [
                                "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-2313483554"
                            ],
                            "daemoned": None,
                            "display_name": "show-artifact-0",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-1037491743",
                            "inputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": {
                                            "access_key_secret": None,
                                            "bucket": None,
                                            "ca_secret": None,
                                            "create_bucket_if_not_present": None,
                                            "encryption_options": None,
                                            "endpoint": None,
                                            "insecure": None,
                                            "key": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9/pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-convert-to-artifact-1820573056/a_art.tgz",
                                            "region": None,
                                            "role_arn": None,
                                            "secret_key_secret": None,
                                            "use_sdk_creds": None,
                                        },
                                        "sub_path": None,
                                    }
                                ],
                                "parameters": None,
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9.show-artifact-0",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 24},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "show-artifact",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                        "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-1820573056": {
                            "boundary_id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                            "children": [
                                "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-1037491743"
                            ],
                            "daemoned": None,
                            "display_name": "convert-to-artifact-0(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                            "id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-1820573056",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "Second integration test value a",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a_art",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9.convert-to-artifact-0(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a_art",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a_art",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": {
                                            "access_key_secret": None,
                                            "bucket": None,
                                            "ca_secret": None,
                                            "create_bucket_if_not_present": None,
                                            "encryption_options": None,
                                            "endpoint": None,
                                            "insecure": None,
                                            "key": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9/pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-convert-to-artifact-1820573056/a_art.tgz",
                                            "region": None,
                                            "role_arn": None,
                                            "secret_key_secret": None,
                                            "use_sdk_creds": None,
                                        },
                                        "sub_path": None,
                                    }
                                ],
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 24},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "convert-to-artifact",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-2313483554": {
                            "boundary_id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                            "children": None,
                            "daemoned": None,
                            "display_name": "show-artifact-0(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                            "id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-2313483554",
                            "inputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": {
                                            "access_key_secret": None,
                                            "bucket": None,
                                            "ca_secret": None,
                                            "create_bucket_if_not_present": None,
                                            "encryption_options": None,
                                            "endpoint": None,
                                            "insecure": None,
                                            "key": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9/pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-convert-to-artifact-1820573056/a_art.tgz",
                                            "region": None,
                                            "role_arn": None,
                                            "secret_key_secret": None,
                                            "use_sdk_creds": None,
                                        },
                                        "sub_path": None,
                                    }
                                ],
                                "parameters": None,
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9.show-artifact-0(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 24},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "show-artifact",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-3688018393": {
                            "boundary_id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9",
                            "children": [
                                "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-1820573056"
                            ],
                            "daemoned": None,
                            "display_name": "convert-to-artifact-0",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-3688018393",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "Second integration test value a",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a_art",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9.convert-to-artifact-0",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a_art",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a_art",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": {
                                            "access_key_secret": None,
                                            "bucket": None,
                                            "ca_secret": None,
                                            "create_bucket_if_not_present": None,
                                            "encryption_options": None,
                                            "endpoint": None,
                                            "insecure": None,
                                            "key": "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9/pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-convert-to-artifact-1820573056/a_art.tgz",
                                            "region": None,
                                            "role_arn": None,
                                            "secret_key_secret": None,
                                            "use_sdk_creds": None,
                                        },
                                        "sub_path": None,
                                    }
                                ],
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "2/2",
                            "resources_duration": {"cpu": 2, "memory": 48},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "convert-to-artifact",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                    },
                    "offload_node_status_version": None,
                    "outputs": None,
                    "persistent_volume_claims": None,
                    "phase": "Succeeded",
                    "progress": "2/2",
                    "resources_duration": {"cpu": 2, "memory": 48},
                    "started_at": datetime.datetime(2022, 11, 8),
                    "stored_templates": {
                        "namespaced/pipeline-test-artifact-pipeline-d5rzf/bettmensch-ai-dag": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": {
                                "fail_fast": None,
                                "target": None,
                                "tasks": [
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{workflow.parameters.a}}",
                                                    "value_from": None,
                                                }
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": None,
                                        "hooks": None,
                                        "inline": None,
                                        "name": "convert-to-artifact-0",
                                        "on_exit": None,
                                        "template": "convert-to-artifact",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": [
                                                {
                                                    "archive": None,
                                                    "archive_logs": None,
                                                    "artifact_gc": None,
                                                    "artifactory": None,
                                                    "azure": None,
                                                    "deleted": None,
                                                    "from_": "{{tasks.convert-to-artifact-0.outputs.artifacts.a_art}}",
                                                    "from_expression": None,
                                                    "gcs": None,
                                                    "git": None,
                                                    "global_name": None,
                                                    "hdfs": None,
                                                    "http": None,
                                                    "mode": None,
                                                    "name": "a",
                                                    "optional": None,
                                                    "oss": None,
                                                    "path": None,
                                                    "raw": None,
                                                    "recurse_mode": None,
                                                    "s3": None,
                                                    "sub_path": None,
                                                }
                                            ],
                                            "parameters": None,
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "convert-to-artifact-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "show-artifact-0",
                                        "on_exit": None,
                                        "template": "show-artifact",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                ],
                            },
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "bettmensch-ai-dag",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-artifact-pipeline-d5rzf/convert-to-artifact": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a_art",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "convert-to-artifact",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a_art",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a_art",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": None,
                                        "sub_path": None,
                                    }
                                ],
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputArtifact\na_art = OutputArtifact(\"a_art\")\n\ndef convert_to_artifact(a: InputParameter, a_art: OutputArtifact=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that converts its InputParameter into\n    an OutputArtifact.\"\"\"\n    with open(a_art.path, 'w') as a_art_file:\n        a_art_file.write(str(a))\nconvert_to_artifact(a,a_art)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-artifact-pipeline-d5rzf/show-artifact": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": [
                                    {
                                        "archive": None,
                                        "archive_logs": None,
                                        "artifact_gc": None,
                                        "artifactory": None,
                                        "azure": None,
                                        "deleted": None,
                                        "from_": None,
                                        "from_expression": None,
                                        "gcs": None,
                                        "git": None,
                                        "global_name": None,
                                        "hdfs": None,
                                        "http": None,
                                        "mode": None,
                                        "name": "a",
                                        "optional": None,
                                        "oss": None,
                                        "path": "a",
                                        "raw": None,
                                        "recurse_mode": None,
                                        "s3": None,
                                        "sub_path": None,
                                    }
                                ],
                                "parameters": None,
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "show-artifact",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": 'import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\n\nfrom bettmensch_ai.io import InputArtifact\na = InputArtifact("a")\n\ndef show_artifact(a: InputArtifact) -> None:\n    """When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputArtifact."""\n    with open(a.path, \'r\') as a_art_file:\n        a_content = a_art_file.read()\n    print(f\'Content of input artifact a: {a_content}\')\nshow_artifact(a)',
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                    },
                    "stored_workflow_template_spec": {
                        "active_deadline_seconds": None,
                        "affinity": None,
                        "archive_logs": None,
                        "arguments": {
                            "artifacts": None,
                            "parameters": [
                                {
                                    "default": None,
                                    "description": None,
                                    "enum": None,
                                    "global_name": None,
                                    "name": "a",
                                    "value": "Second integration test value a",
                                    "value_from": None,
                                }
                            ],
                        },
                        "artifact_gc": None,
                        "artifact_repository_ref": None,
                        "automount_service_account_token": None,
                        "dns_config": None,
                        "dns_policy": None,
                        "entrypoint": "bettmensch-ai-dag",
                        "executor": None,
                        "hooks": None,
                        "host_aliases": None,
                        "host_network": None,
                        "image_pull_secrets": None,
                        "metrics": None,
                        "node_selector": None,
                        "on_exit": None,
                        "parallelism": None,
                        "pod_disruption_budget": None,
                        "pod_gc": None,
                        "pod_metadata": None,
                        "pod_priority": None,
                        "pod_priority_class_name": None,
                        "pod_spec_patch": None,
                        "priority": None,
                        "retry_strategy": None,
                        "scheduler_name": None,
                        "security_context": None,
                        "service_account_name": "argo-workflow",
                        "shutdown": None,
                        "suspend": None,
                        "synchronization": None,
                        "template_defaults": None,
                        "templates": [
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": {
                                    "fail_fast": None,
                                    "target": None,
                                    "tasks": [
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "a",
                                                        "value": "{{workflow.parameters.a}}",
                                                        "value_from": None,
                                                    }
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": None,
                                            "hooks": None,
                                            "inline": None,
                                            "name": "convert-to-artifact-0",
                                            "on_exit": None,
                                            "template": "convert-to-artifact",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": [
                                                    {
                                                        "archive": None,
                                                        "archive_logs": None,
                                                        "artifact_gc": None,
                                                        "artifactory": None,
                                                        "azure": None,
                                                        "deleted": None,
                                                        "from_": "{{tasks.convert-to-artifact-0.outputs.artifacts.a_art}}",
                                                        "from_expression": None,
                                                        "gcs": None,
                                                        "git": None,
                                                        "global_name": None,
                                                        "hdfs": None,
                                                        "http": None,
                                                        "mode": None,
                                                        "name": "a",
                                                        "optional": None,
                                                        "oss": None,
                                                        "path": None,
                                                        "raw": None,
                                                        "recurse_mode": None,
                                                        "s3": None,
                                                        "sub_path": None,
                                                    }
                                                ],
                                                "parameters": None,
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "convert-to-artifact-0",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "show-artifact-0",
                                            "on_exit": None,
                                            "template": "show-artifact",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                    ],
                                },
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": None,
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "bettmensch-ai-dag",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": None,
                                "scheduler_name": None,
                                "script": None,
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "a",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "None",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "a_art",
                                            "value": None,
                                            "value_from": None,
                                        },
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "convert-to-artifact",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": [
                                        {
                                            "archive": None,
                                            "archive_logs": None,
                                            "artifact_gc": None,
                                            "artifactory": None,
                                            "azure": None,
                                            "deleted": None,
                                            "from_": None,
                                            "from_expression": None,
                                            "gcs": None,
                                            "git": None,
                                            "global_name": None,
                                            "hdfs": None,
                                            "http": None,
                                            "mode": None,
                                            "name": "a_art",
                                            "optional": None,
                                            "oss": None,
                                            "path": "a_art",
                                            "raw": None,
                                            "recurse_mode": None,
                                            "s3": None,
                                            "sub_path": None,
                                        }
                                    ],
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": None,
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputArtifact\na_art = OutputArtifact(\"a_art\")\n\ndef convert_to_artifact(a: InputParameter, a_art: OutputArtifact=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that converts its InputParameter into\n    an OutputArtifact.\"\"\"\n    with open(a_art.path, 'w') as a_art_file:\n        a_art_file.write(str(a))\nconvert_to_artifact(a,a_art)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": [
                                        {
                                            "archive": None,
                                            "archive_logs": None,
                                            "artifact_gc": None,
                                            "artifactory": None,
                                            "azure": None,
                                            "deleted": None,
                                            "from_": None,
                                            "from_expression": None,
                                            "gcs": None,
                                            "git": None,
                                            "global_name": None,
                                            "hdfs": None,
                                            "http": None,
                                            "mode": None,
                                            "name": "a",
                                            "optional": None,
                                            "oss": None,
                                            "path": "a",
                                            "raw": None,
                                            "recurse_mode": None,
                                            "s3": None,
                                            "sub_path": None,
                                        }
                                    ],
                                    "parameters": None,
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "show-artifact",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": None,
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                    },
                                    "security_context": None,
                                    "source": 'import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\n\nfrom bettmensch_ai.io import InputArtifact\na = InputArtifact("a")\n\ndef show_artifact(a: InputArtifact) -> None:\n    """When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputArtifact."""\n    with open(a.path, \'r\') as a_art_file:\n        a_content = a_art_file.read()\n    print(f\'Content of input artifact a: {a_content}\')\nshow_artifact(a)',
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                        ],
                        "tolerations": None,
                        "ttl_strategy": None,
                        "volume_claim_gc": None,
                        "volume_claim_templates": None,
                        "volumes": None,
                        "workflow_metadata": None,
                        "workflow_template_ref": {
                            "cluster_scope": None,
                            "name": "pipeline-test-artifact-pipeline-d5rzf",
                        },
                    },
                    "synchronization": None,
                    "task_results_completion_status": {
                        "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-1820573056": True,
                        "pipeline-test-artifact-pipeline-d5rzf-flow-pmrv9-2313483554": True,
                    },
                },
            }

    return MockHeraWorkflowModel()


@pytest.fixture
def test_hera_parameter_workflow_model():
    class MockHeraWorkflowModel:
        def dict(self):

            return {
                "api_version": None,
                "kind": None,
                "metadata": {
                    "annotations": {
                        "karpenter.sh/do-not-disrupt": "True",
                        "workflows.argoproj.io/pod-name-format": "v2",
                    },
                    "cluster_name": None,
                    "creation_timestamp": datetime.datetime(2022, 11, 8),
                    "deletion_grace_period_seconds": None,
                    "deletion_timestamp": None,
                    "finalizers": None,
                    "generate_name": "pipeline-test-parameter-pipeline-mhwgd-flow-",
                    "generation": 6,
                    "labels": {
                        "workflows.argoproj.io/completed": "True",
                        "workflows.argoproj.io/creator": "system-serviceaccount-argo-argo-server",
                        "workflows.argoproj.io/phase": "Succeeded",
                    },
                    "managed_fields": [
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "argo",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2022, 11, 8),
                        },
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "workflow-controller",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2022, 11, 8),
                        },
                    ],
                    "name": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                    "namespace": "argo",
                    "owner_references": None,
                    "resource_version": "18503",
                    "self_link": None,
                    "uid": "ddfe31ae-1231-4a2d-be6c-4b712bcc15a6",
                },
                "spec": {
                    "active_deadline_seconds": None,
                    "affinity": None,
                    "archive_logs": None,
                    "arguments": {
                        "artifacts": None,
                        "parameters": [
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "a",
                                "value": "-10",
                                "value_from": None,
                            },
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "b",
                                "value": "20",
                                "value_from": None,
                            },
                        ],
                    },
                    "artifact_gc": None,
                    "artifact_repository_ref": None,
                    "automount_service_account_token": None,
                    "dns_config": None,
                    "dns_policy": None,
                    "entrypoint": None,
                    "executor": None,
                    "hooks": None,
                    "host_aliases": None,
                    "host_network": None,
                    "image_pull_secrets": None,
                    "metrics": None,
                    "node_selector": None,
                    "on_exit": None,
                    "parallelism": None,
                    "pod_disruption_budget": None,
                    "pod_gc": None,
                    "pod_metadata": None,
                    "pod_priority": None,
                    "pod_priority_class_name": None,
                    "pod_spec_patch": None,
                    "priority": None,
                    "retry_strategy": None,
                    "scheduler_name": None,
                    "security_context": None,
                    "service_account_name": None,
                    "shutdown": None,
                    "suspend": None,
                    "synchronization": None,
                    "template_defaults": None,
                    "templates": None,
                    "tolerations": None,
                    "ttl_strategy": None,
                    "volume_claim_gc": None,
                    "volume_claim_templates": None,
                    "volumes": None,
                    "workflow_metadata": None,
                    "workflow_template_ref": {
                        "cluster_scope": None,
                        "name": "pipeline-test-parameter-pipeline-mhwgd",
                    },
                },
                "status": {
                    "artifact_gc_status": {
                        "not_specified": True,
                        "pods_recouped": None,
                        "strategies_processed": None,
                    },
                    "artifact_repository_ref": {
                        "artifact_repository": {
                            "archive_logs": None,
                            "artifactory": None,
                            "azure": None,
                            "gcs": None,
                            "hdfs": None,
                            "oss": None,
                            "s3": {
                                "access_key_secret": None,
                                "bucket": "bettmensch-ai-artifact-repository",
                                "ca_secret": None,
                                "create_bucket_if_not_present": None,
                                "encryption_options": None,
                                "endpoint": "s3.us-east-2.amazonaws.com",
                                "insecure": True,
                                "key_format": None,
                                "key_prefix": None,
                                "region": None,
                                "role_arn": None,
                                "secret_key_secret": None,
                                "use_sdk_creds": None,
                            },
                        },
                        "config_map": "artifact-repositories",
                        "default": None,
                        "key": "bettmensch-ai-artifact-repository",
                        "namespace": "argo",
                    },
                    "compressed_nodes": None,
                    "conditions": [
                        {
                            "message": None,
                            "status": "False",
                            "type": "PodRunning",
                        },
                        {
                            "message": None,
                            "status": "True",
                            "type": "Completed",
                        },
                    ],
                    "estimated_duration": None,
                    "finished_at": datetime.datetime(2022, 11, 8),
                    "message": None,
                    "nodes": {
                        "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp": {
                            "boundary_id": None,
                            "children": [
                                "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-4203966729"
                            ],
                            "daemoned": None,
                            "display_name": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                            "inputs": None,
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                            "node_flag": None,
                            "outbound_nodes": [
                                "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-2921145384"
                            ],
                            "outputs": None,
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "2/2",
                            "resources_duration": {"cpu": 2, "memory": 47},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "bettmensch-ai-dag",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "DAG",
                        },
                        "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-2921145384": {
                            "boundary_id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                            "children": None,
                            "daemoned": None,
                            "display_name": "a-plus-b-plus-2-0(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                            "id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-2921145384",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "10",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": "2",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp.a-plus-b-plus-2-0(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "12",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 23},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "a-plus-b-plus-2",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-3352155217": {
                            "boundary_id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                            "children": [
                                "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-2921145384"
                            ],
                            "daemoned": None,
                            "display_name": "a-plus-b-plus-2-0",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-3352155217",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "10",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": "2",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp.a-plus-b-plus-2-0",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "12",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 23},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "a-plus-b-plus-2",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                        "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-3648717680": {
                            "boundary_id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                            "children": [
                                "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-3352155217"
                            ],
                            "daemoned": None,
                            "display_name": "a-plus-b-0(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                            "id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-3648717680",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "-10",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": "20",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp.a-plus-b-0(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "10",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 24},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "a-plus-b",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-4203966729": {
                            "boundary_id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp",
                            "children": [
                                "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-3648717680"
                            ],
                            "daemoned": None,
                            "display_name": "a-plus-b-0",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-4203966729",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "-10",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": "20",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp.a-plus-b-0",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": "10",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "2/2",
                            "resources_duration": {"cpu": 2, "memory": 47},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "a-plus-b",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                    },
                    "offload_node_status_version": None,
                    "outputs": None,
                    "persistent_volume_claims": None,
                    "phase": "Succeeded",
                    "progress": "2/2",
                    "resources_duration": {"cpu": 2, "memory": 47},
                    "started_at": datetime.datetime(2022, 11, 8),
                    "stored_templates": {
                        "namespaced/pipeline-test-parameter-pipeline-mhwgd/a-plus-b": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "a-plus-b",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\ntry: b = json.loads(r'''{{inputs.parameters.b}}''')\nexcept: b = r'''{{inputs.parameters.b}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nsum = OutputParameter(\"sum\")\n\ndef add_parameters(a: InputParameter=1, b: InputParameter=2, sum: OutputParameter=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a simple addition bettmensch_ai.Component.\"\"\"\n    sum.assign(a + b)\nadd_parameters(a,b,sum)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-parameter-pipeline-mhwgd/a-plus-b-plus-2": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "1",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "2",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "b",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "a-plus-b-plus-2",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "sum",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "sum",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\ntry: b = json.loads(r'''{{inputs.parameters.b}}''')\nexcept: b = r'''{{inputs.parameters.b}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nsum = OutputParameter(\"sum\")\n\ndef add_parameters(a: InputParameter=1, b: InputParameter=2, sum: OutputParameter=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a simple addition bettmensch_ai.Component.\"\"\"\n    sum.assign(a + b)\nadd_parameters(a,b,sum)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-parameter-pipeline-mhwgd/bettmensch-ai-dag": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": {
                                "fail_fast": None,
                                "target": None,
                                "tasks": [
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{workflow.parameters.a}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "b",
                                                    "value": "{{workflow.parameters.b}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": None,
                                        "hooks": None,
                                        "inline": None,
                                        "name": "a-plus-b-0",
                                        "on_exit": None,
                                        "template": "a-plus-b",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{tasks.a-plus-b-0.outputs.parameters.sum}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "b",
                                                    "value": "2",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "a-plus-b-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "a-plus-b-plus-2-0",
                                        "on_exit": None,
                                        "template": "a-plus-b-plus-2",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                ],
                            },
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "bettmensch-ai-dag",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                    },
                    "stored_workflow_template_spec": {
                        "active_deadline_seconds": None,
                        "affinity": None,
                        "archive_logs": None,
                        "arguments": {
                            "artifacts": None,
                            "parameters": [
                                {
                                    "default": None,
                                    "description": None,
                                    "enum": None,
                                    "global_name": None,
                                    "name": "a",
                                    "value": "-10",
                                    "value_from": None,
                                },
                                {
                                    "default": None,
                                    "description": None,
                                    "enum": None,
                                    "global_name": None,
                                    "name": "b",
                                    "value": "20",
                                    "value_from": None,
                                },
                            ],
                        },
                        "artifact_gc": None,
                        "artifact_repository_ref": None,
                        "automount_service_account_token": None,
                        "dns_config": None,
                        "dns_policy": None,
                        "entrypoint": "bettmensch-ai-dag",
                        "executor": None,
                        "hooks": None,
                        "host_aliases": None,
                        "host_network": None,
                        "image_pull_secrets": None,
                        "metrics": None,
                        "node_selector": None,
                        "on_exit": None,
                        "parallelism": None,
                        "pod_disruption_budget": None,
                        "pod_gc": None,
                        "pod_metadata": None,
                        "pod_priority": None,
                        "pod_priority_class_name": None,
                        "pod_spec_patch": None,
                        "priority": None,
                        "retry_strategy": None,
                        "scheduler_name": None,
                        "security_context": None,
                        "service_account_name": "argo-workflow",
                        "shutdown": None,
                        "suspend": None,
                        "synchronization": None,
                        "template_defaults": None,
                        "templates": [
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": {
                                    "fail_fast": None,
                                    "target": None,
                                    "tasks": [
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "a",
                                                        "value": "{{workflow.parameters.a}}",
                                                        "value_from": None,
                                                    },
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "b",
                                                        "value": "{{workflow.parameters.b}}",
                                                        "value_from": None,
                                                    },
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": None,
                                            "hooks": None,
                                            "inline": None,
                                            "name": "a-plus-b-0",
                                            "on_exit": None,
                                            "template": "a-plus-b",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "a",
                                                        "value": "{{tasks.a-plus-b-0.outputs.parameters.sum}}",
                                                        "value_from": None,
                                                    },
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "b",
                                                        "value": "2",
                                                        "value_from": None,
                                                    },
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "a-plus-b-0",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "a-plus-b-plus-2-0",
                                            "on_exit": None,
                                            "template": "a-plus-b-plus-2",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                    ],
                                },
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": None,
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "bettmensch-ai-dag",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": None,
                                "scheduler_name": None,
                                "script": None,
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": "1",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "a",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "2",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "b",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "None",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "sum",
                                            "value": None,
                                            "value_from": None,
                                        },
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "a-plus-b",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "sum",
                                            "value": None,
                                            "value_from": {
                                                "config_map_key_ref": None,
                                                "default": None,
                                                "event": None,
                                                "expression": None,
                                                "jq_filter": None,
                                                "json_path": None,
                                                "parameter": None,
                                                "path": "sum",
                                                "supplied": None,
                                            },
                                        }
                                    ],
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": None,
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\ntry: b = json.loads(r'''{{inputs.parameters.b}}''')\nexcept: b = r'''{{inputs.parameters.b}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nsum = OutputParameter(\"sum\")\n\ndef add_parameters(a: InputParameter=1, b: InputParameter=2, sum: OutputParameter=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a simple addition bettmensch_ai.Component.\"\"\"\n    sum.assign(a + b)\nadd_parameters(a,b,sum)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": "1",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "a",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "2",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "b",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "None",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "sum",
                                            "value": None,
                                            "value_from": None,
                                        },
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "a-plus-b-plus-2",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "sum",
                                            "value": None,
                                            "value_from": {
                                                "config_map_key_ref": None,
                                                "default": None,
                                                "event": None,
                                                "expression": None,
                                                "jq_filter": None,
                                                "json_path": None,
                                                "parameter": None,
                                                "path": "sum",
                                                "supplied": None,
                                            },
                                        }
                                    ],
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": None,
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\ntry: b = json.loads(r'''{{inputs.parameters.b}}''')\nexcept: b = r'''{{inputs.parameters.b}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nsum = OutputParameter(\"sum\")\n\ndef add_parameters(a: InputParameter=1, b: InputParameter=2, sum: OutputParameter=None) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a simple addition bettmensch_ai.Component.\"\"\"\n    sum.assign(a + b)\nadd_parameters(a,b,sum)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                        ],
                        "tolerations": None,
                        "ttl_strategy": None,
                        "volume_claim_gc": None,
                        "volume_claim_templates": None,
                        "volumes": None,
                        "workflow_metadata": None,
                        "workflow_template_ref": {
                            "cluster_scope": None,
                            "name": "pipeline-test-parameter-pipeline-mhwgd",
                        },
                    },
                    "synchronization": None,
                    "task_results_completion_status": {
                        "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-2921145384": True,
                        "pipeline-test-parameter-pipeline-mhwgd-flow-hgtcp-3648717680": True,
                    },
                },
            }

    return MockHeraWorkflowModel()


@pytest.fixture
def test_hera_torch_gpu_workflow_model():
    class MockHeraWorkflowModel:
        def dict(self):

            return {
                "api_version": None,
                "kind": None,
                "metadata": {
                    "annotations": {
                        "karpenter.sh/do-not-disrupt": "True",
                        "workflows.argoproj.io/pod-name-format": "v2",
                    },
                    "cluster_name": None,
                    "creation_timestamp": datetime.datetime(2022, 11, 8),
                    "deletion_grace_period_seconds": None,
                    "deletion_timestamp": None,
                    "finalizers": None,
                    "generate_name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-",
                    "generation": 13,
                    "labels": {
                        "workflows.argoproj.io/completed": "True",
                        "workflows.argoproj.io/creator": "system-serviceaccount-argo-argo-server",
                        "workflows.argoproj.io/phase": "Succeeded",
                    },
                    "managed_fields": [
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "argo",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2022, 11, 8),
                        },
                        {
                            "api_version": "argoproj.io/v1alpha1",
                            "fields_type": "FieldsV1",
                            "fields_v1": {},
                            "manager": "workflow-controller",
                            "operation": "Update",
                            "subresource": None,
                            "time": datetime.datetime(2022, 11, 8),
                        },
                    ],
                    "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                    "namespace": "argo",
                    "owner_references": None,
                    "resource_version": "13587",
                    "self_link": None,
                    "uid": "93098e5d-b8fe-4e2a-83d8-e19b7489c980",
                },
                "spec": {
                    "active_deadline_seconds": None,
                    "affinity": None,
                    "archive_logs": None,
                    "arguments": {
                        "artifacts": None,
                        "parameters": [
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "n_iter",
                                "value": "12",
                                "value_from": None,
                            },
                            {
                                "default": None,
                                "description": None,
                                "enum": None,
                                "global_name": None,
                                "name": "n_seconds_sleep",
                                "value": "5",
                                "value_from": None,
                            },
                        ],
                    },
                    "artifact_gc": None,
                    "artifact_repository_ref": None,
                    "automount_service_account_token": None,
                    "dns_config": None,
                    "dns_policy": None,
                    "entrypoint": None,
                    "executor": None,
                    "hooks": None,
                    "host_aliases": None,
                    "host_network": None,
                    "image_pull_secrets": None,
                    "metrics": None,
                    "node_selector": None,
                    "on_exit": None,
                    "parallelism": None,
                    "pod_disruption_budget": None,
                    "pod_gc": None,
                    "pod_metadata": None,
                    "pod_priority": None,
                    "pod_priority_class_name": None,
                    "pod_spec_patch": None,
                    "priority": None,
                    "retry_strategy": None,
                    "scheduler_name": None,
                    "security_context": None,
                    "service_account_name": None,
                    "shutdown": None,
                    "suspend": None,
                    "synchronization": None,
                    "template_defaults": None,
                    "templates": None,
                    "tolerations": None,
                    "ttl_strategy": None,
                    "volume_claim_gc": None,
                    "volume_claim_templates": None,
                    "volumes": None,
                    "workflow_metadata": None,
                    "workflow_template_ref": {
                        "cluster_scope": None,
                        "name": "pipeline-test-torch-gpu-pipeline-dcfq8",
                    },
                },
                "status": {
                    "artifact_gc_status": {
                        "not_specified": True,
                        "pods_recouped": None,
                        "strategies_processed": None,
                    },
                    "artifact_repository_ref": {
                        "artifact_repository": {
                            "archive_logs": None,
                            "artifactory": None,
                            "azure": None,
                            "gcs": None,
                            "hdfs": None,
                            "oss": None,
                            "s3": {
                                "access_key_secret": None,
                                "bucket": "bettmensch-ai-artifact-repository",
                                "ca_secret": None,
                                "create_bucket_if_not_present": None,
                                "encryption_options": None,
                                "endpoint": "s3.us-east-2.amazonaws.com",
                                "insecure": True,
                                "key_format": None,
                                "key_prefix": None,
                                "region": None,
                                "role_arn": None,
                                "secret_key_secret": None,
                                "use_sdk_creds": None,
                            },
                        },
                        "config_map": "artifact-repositories",
                        "default": None,
                        "key": "bettmensch-ai-artifact-repository",
                        "namespace": "argo",
                    },
                    "compressed_nodes": None,
                    "conditions": [
                        {
                            "message": None,
                            "status": "False",
                            "type": "PodRunning",
                        },
                        {
                            "message": None,
                            "status": "True",
                            "type": "Completed",
                        },
                    ],
                    "estimated_duration": None,
                    "finished_at": datetime.datetime(2022, 11, 8),
                    "message": None,
                    "nodes": {
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx": {
                            "boundary_id": None,
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2966531784"
                            ],
                            "daemoned": None,
                            "display_name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "inputs": None,
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "node_flag": None,
                            "outbound_nodes": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-842282759",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1906221877",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2953909358",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2336401843",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1501533811",
                            ],
                            "outputs": None,
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "7/7",
                            "resources_duration": {
                                "cpu": 57,
                                "memory": 4087,
                                "nvidia.com/gpu": 500,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "bettmensch-ai-dag",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "DAG",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1501533811": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": None,
                            "daemoned": None,
                            "display_name": "torch-ddp-delete-torch-service",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1501533811",
                            "inputs": None,
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-delete-torch-service",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 0, "memory": 0},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-delete-torch-service",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1664656268": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-842282759"
                            ],
                            "daemoned": None,
                            "display_name": "show-duration-param-0",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1664656268",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "60",
                                        "value_from": None,
                                    }
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.show-duration-param-0",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 23},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "show-duration-param",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1906221877": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": None,
                            "daemoned": None,
                            "display_name": "torch-ddp-0-worker-1(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-50-242.us-east-2.compute.internal",
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1906221877",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0-worker-1(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {
                                "cpu": 14,
                                "memory": 1013,
                                "nvidia.com/gpu": 124,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-1",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-200409488": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2336401843"
                            ],
                            "daemoned": None,
                            "display_name": "torch-ddp-0-worker-3",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-200409488",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0-worker-3",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {
                                "cpu": 14,
                                "memory": 973,
                                "nvidia.com/gpu": 120,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-3",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-217187107": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2953909358"
                            ],
                            "daemoned": None,
                            "display_name": "torch-ddp-0-worker-2",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-217187107",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0-worker-2",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {
                                "cpu": 13,
                                "memory": 966,
                                "nvidia.com/gpu": 118,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-2",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2258088662": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1664656268",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1501533811",
                            ],
                            "daemoned": None,
                            "display_name": "torch-ddp-0(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-49-47.us-east-2.compute.internal",
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2258088662",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {
                                "cpu": 15,
                                "memory": 1112,
                                "nvidia.com/gpu": 138,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-0",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2336401843": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": None,
                            "daemoned": None,
                            "display_name": "torch-ddp-0-worker-3(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-49-43.us-east-2.compute.internal",
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2336401843",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0-worker-3(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {
                                "cpu": 14,
                                "memory": 973,
                                "nvidia.com/gpu": 120,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-3",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-233964726": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1906221877"
                            ],
                            "daemoned": None,
                            "display_name": "torch-ddp-0-worker-1",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-233964726",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0-worker-1",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {
                                "cpu": 14,
                                "memory": 1013,
                                "nvidia.com/gpu": 124,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-1",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2953909358": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": None,
                            "daemoned": None,
                            "display_name": "torch-ddp-0-worker-2(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-50-184.us-east-2.compute.internal",
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2953909358",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0-worker-2(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {
                                "cpu": 13,
                                "memory": 966,
                                "nvidia.com/gpu": 118,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-2",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2966531784": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-3686612827",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-233964726",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-217187107",
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-200409488",
                            ],
                            "daemoned": None,
                            "display_name": "torch-ddp-create-torch-service",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2966531784",
                            "inputs": None,
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-create-torch-service",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 0, "memory": 0},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-create-torch-service",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-3686612827": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": [
                                "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2258088662"
                            ],
                            "daemoned": None,
                            "display_name": "torch-ddp-0",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": None,
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-3686612827",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": "12",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": "5",
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "None",
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.torch-ddp-0",
                            "node_flag": None,
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": "60",
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "3/3",
                            "resources_duration": {
                                "cpu": 16,
                                "memory": 1135,
                                "nvidia.com/gpu": 138,
                            },
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "torch-ddp-0",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Retry",
                        },
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-842282759": {
                            "boundary_id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx",
                            "children": None,
                            "daemoned": None,
                            "display_name": "show-duration-param-0(0)",
                            "estimated_duration": None,
                            "finished_at": datetime.datetime(2022, 11, 8),
                            "host_node_name": "ip-10-0-48-52.us-east-2.compute.internal",
                            "id": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-842282759",
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": "60",
                                        "value_from": None,
                                    }
                                ],
                            },
                            "memoization_status": None,
                            "message": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx.show-duration-param-0(0)",
                            "node_flag": {"hooked": None, "retried": True},
                            "outbound_nodes": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": "0",
                                "parameters": None,
                                "result": None,
                            },
                            "phase": "Succeeded",
                            "pod_ip": None,
                            "progress": "1/1",
                            "resources_duration": {"cpu": 1, "memory": 23},
                            "started_at": datetime.datetime(2022, 11, 8),
                            "synchronization_status": None,
                            "template_name": "show-duration-param",
                            "template_ref": None,
                            "template_scope": "local/",
                            "type": "Pod",
                        },
                    },
                    "offload_node_status_version": None,
                    "outputs": None,
                    "persistent_volume_claims": None,
                    "phase": "Succeeded",
                    "progress": "7/7",
                    "resources_duration": {
                        "cpu": 57,
                        "memory": 4087,
                        "nvidia.com/gpu": 500,
                    },
                    "started_at": datetime.datetime(2022, 11, 8),
                    "stored_templates": {
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/bettmensch-ai-dag": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": {
                                "fail_fast": None,
                                "target": None,
                                "tasks": [
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": None,
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": None,
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-create-torch-service",
                                        "on_exit": None,
                                        "template": "torch-ddp-create-torch-service",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0",
                                        "on_exit": None,
                                        "template": "torch-ddp-0",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0-worker-1",
                                        "on_exit": None,
                                        "template": "torch-ddp-1",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0-worker-2",
                                        "on_exit": None,
                                        "template": "torch-ddp-2",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_iter",
                                                    "value": "{{workflow.parameters.n_iter}}",
                                                    "value_from": None,
                                                },
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "n_seconds_sleep",
                                                    "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                    "value_from": None,
                                                },
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-create-torch-service",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-0-worker-3",
                                        "on_exit": None,
                                        "template": "torch-ddp-3",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": None,
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "torch-ddp-delete-torch-service",
                                        "on_exit": None,
                                        "template": "torch-ddp-delete-torch-service",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                    {
                                        "arguments": {
                                            "artifacts": None,
                                            "parameters": [
                                                {
                                                    "default": None,
                                                    "description": None,
                                                    "enum": None,
                                                    "global_name": None,
                                                    "name": "a",
                                                    "value": "{{tasks.torch-ddp-0.outputs.parameters.duration}}",
                                                    "value_from": None,
                                                }
                                            ],
                                        },
                                        "continue_on": None,
                                        "dependencies": None,
                                        "depends": "torch-ddp-0",
                                        "hooks": None,
                                        "inline": None,
                                        "name": "show-duration-param-0",
                                        "on_exit": None,
                                        "template": "show-duration-param",
                                        "template_ref": None,
                                        "when": None,
                                        "with_items": None,
                                        "with_param": None,
                                        "with_sequence": None,
                                    },
                                ],
                            },
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "bettmensch-ai-dag",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/show-duration-param": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "a",
                                        "value": None,
                                        "value_from": None,
                                    }
                                ],
                            },
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "show-duration-param",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": None,
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "100Mi",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\ndef show_parameter(a: InputParameter) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputParameter.\"\"\"\n    print(f'Content of input parameter a is: {a}')\nshow_parameter(a)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/torch-ddp-0": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "0",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-0",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": [
                                    {
                                        "container_port": 29200,
                                        "host_ip": None,
                                        "host_port": None,
                                        "name": "ddp",
                                        "protocol": "TCP",
                                    }
                                ],
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/torch-ddp-1": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "1",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-1",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/torch-ddp-2": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "2",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-2",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "2",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/torch-ddp-3": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {
                                "artifacts": None,
                                "parameters": [
                                    {
                                        "default": "100",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_iter",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "10",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "n_seconds_sleep",
                                        "value": None,
                                        "value_from": None,
                                    },
                                    {
                                        "default": "None",
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": None,
                                    },
                                ],
                            },
                            "memoize": None,
                            "metadata": {
                                "annotations": None,
                                "labels": {
                                    "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "torch-node": "3",
                                },
                            },
                            "metrics": None,
                            "name": "torch-ddp-3",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": [
                                    {
                                        "default": None,
                                        "description": None,
                                        "enum": None,
                                        "global_name": None,
                                        "name": "duration",
                                        "value": None,
                                        "value_from": {
                                            "config_map_key_ref": None,
                                            "default": None,
                                            "event": None,
                                            "expression": None,
                                            "jq_filter": None,
                                            "json_path": None,
                                            "parameter": None,
                                            "path": "duration",
                                            "supplied": None,
                                        },
                                    }
                                ],
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                            "priority": None,
                            "priority_class_name": None,
                            "resource": None,
                            "retry_strategy": {
                                "affinity": None,
                                "backoff": None,
                                "expression": None,
                                "limit": "1",
                                "retry_policy": "OnError",
                            },
                            "scheduler_name": None,
                            "script": {
                                "args": None,
                                "command": ["python"],
                                "env": [
                                    {
                                        "name": "NCCL_DEBUG",
                                        "value": "INFO",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_min_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_nodes",
                                        "value": "4",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_node_rank",
                                        "value": "3",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_max_restarts",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_start_method",
                                        "value": "fork",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                        "value": "static",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                        "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                        "value": "29200",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_run_id",
                                        "value": "1",
                                        "value_from": None,
                                    },
                                    {
                                        "name": "bettmensch_ai_distributed_torch_tee",
                                        "value": "0",
                                        "value_from": None,
                                    },
                                ],
                                "env_from": None,
                                "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                "image_pull_policy": "Always",
                                "lifecycle": None,
                                "liveness_probe": None,
                                "name": "",
                                "ports": None,
                                "readiness_probe": None,
                                "resources": {
                                    "limits": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                    "requests": {
                                        "cpu": "100m",
                                        "memory": "700Mi",
                                        "nvidia.com/gpu": "1",
                                    },
                                },
                                "security_context": None,
                                "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                "startup_probe": None,
                                "stdin": None,
                                "stdin_once": None,
                                "termination_message_path": None,
                                "termination_message_policy": None,
                                "tty": None,
                                "volume_devices": None,
                                "volume_mounts": None,
                                "working_dir": None,
                            },
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": [
                                {
                                    "effect": "NoSchedule",
                                    "key": "nvidia.com/gpu",
                                    "operator": "Exists",
                                    "toleration_seconds": None,
                                    "value": None,
                                }
                            ],
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/torch-ddp-create-torch-service": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "torch-ddp-create-torch-service",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": {
                                "action": "create",
                                "failure_condition": None,
                                "flags": None,
                                "manifest": "apiVersion: v1\nkind: Service\nmetadata:\n  name: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\n  namespace: argo\n  labels:\n    app: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\nspec:\n  clusterIP: None  # ClusterIP set to None for headless service.\n  ports:\n  - name: ddp  # Port for torchrun master<->worker node coms.\n    port: 29200\n    targetPort: 29200\n  selector:\n    torch-job: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\n    torch-node: '0'  # Selector for pods associated with this service.\n",
                                "manifest_from": None,
                                "merge_strategy": None,
                                "set_owner_reference": None,
                                "success_condition": None,
                            },
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                        "namespaced/pipeline-test-torch-gpu-pipeline-dcfq8/torch-ddp-delete-torch-service": {
                            "active_deadline_seconds": None,
                            "affinity": None,
                            "archive_location": None,
                            "automount_service_account_token": None,
                            "container": None,
                            "container_set": None,
                            "daemon": None,
                            "dag": None,
                            "data": None,
                            "executor": None,
                            "fail_fast": None,
                            "host_aliases": None,
                            "http": None,
                            "init_containers": None,
                            "inputs": {"artifacts": None, "parameters": None},
                            "memoize": None,
                            "metadata": {"annotations": None, "labels": None},
                            "metrics": None,
                            "name": "torch-ddp-delete-torch-service",
                            "node_selector": None,
                            "outputs": {
                                "artifacts": None,
                                "exit_code": None,
                                "parameters": None,
                                "result": None,
                            },
                            "parallelism": None,
                            "plugin": None,
                            "pod_spec_patch": None,
                            "priority": None,
                            "priority_class_name": None,
                            "resource": {
                                "action": "delete",
                                "failure_condition": None,
                                "flags": [
                                    "service",
                                    "--selector",
                                    "torch-job=torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                    "-n",
                                    "argo",
                                ],
                                "manifest": None,
                                "manifest_from": None,
                                "merge_strategy": None,
                                "set_owner_reference": None,
                                "success_condition": None,
                            },
                            "retry_strategy": None,
                            "scheduler_name": None,
                            "script": None,
                            "security_context": None,
                            "service_account_name": None,
                            "sidecars": None,
                            "steps": None,
                            "suspend": None,
                            "synchronization": None,
                            "timeout": None,
                            "tolerations": None,
                            "volumes": None,
                        },
                    },
                    "stored_workflow_template_spec": {
                        "active_deadline_seconds": None,
                        "affinity": None,
                        "archive_logs": None,
                        "arguments": {
                            "artifacts": None,
                            "parameters": [
                                {
                                    "default": None,
                                    "description": None,
                                    "enum": None,
                                    "global_name": None,
                                    "name": "n_iter",
                                    "value": "12",
                                    "value_from": None,
                                },
                                {
                                    "default": None,
                                    "description": None,
                                    "enum": None,
                                    "global_name": None,
                                    "name": "n_seconds_sleep",
                                    "value": "5",
                                    "value_from": None,
                                },
                            ],
                        },
                        "artifact_gc": None,
                        "artifact_repository_ref": None,
                        "automount_service_account_token": None,
                        "dns_config": None,
                        "dns_policy": None,
                        "entrypoint": "bettmensch-ai-dag",
                        "executor": None,
                        "hooks": None,
                        "host_aliases": None,
                        "host_network": None,
                        "image_pull_secrets": None,
                        "metrics": None,
                        "node_selector": None,
                        "on_exit": None,
                        "parallelism": None,
                        "pod_disruption_budget": None,
                        "pod_gc": None,
                        "pod_metadata": None,
                        "pod_priority": None,
                        "pod_priority_class_name": None,
                        "pod_spec_patch": None,
                        "priority": None,
                        "retry_strategy": None,
                        "scheduler_name": None,
                        "security_context": None,
                        "service_account_name": "argo-workflow",
                        "shutdown": None,
                        "suspend": None,
                        "synchronization": None,
                        "template_defaults": None,
                        "templates": [
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": None,
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "torch-ddp-create-torch-service",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": {
                                    "action": "create",
                                    "failure_condition": None,
                                    "flags": None,
                                    "manifest": "apiVersion: v1\nkind: Service\nmetadata:\n  name: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\n  namespace: argo\n  labels:\n    app: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\nspec:\n  clusterIP: None  # ClusterIP set to None for headless service.\n  ports:\n  - name: ddp  # Port for torchrun master<->worker node coms.\n    port: 29200\n    targetPort: 29200\n  selector:\n    torch-job: torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6\n    torch-node: '0'  # Selector for pods associated with this service.\n",
                                    "manifest_from": None,
                                    "merge_strategy": None,
                                    "set_owner_reference": None,
                                    "success_condition": None,
                                },
                                "retry_strategy": None,
                                "scheduler_name": None,
                                "script": None,
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": None,
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "torch-ddp-delete-torch-service",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": {
                                    "action": "delete",
                                    "failure_condition": None,
                                    "flags": [
                                        "service",
                                        "--selector",
                                        "torch-job=torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                        "-n",
                                        "argo",
                                    ],
                                    "manifest": None,
                                    "manifest_from": None,
                                    "merge_strategy": None,
                                    "set_owner_reference": None,
                                    "success_condition": None,
                                },
                                "retry_strategy": None,
                                "scheduler_name": None,
                                "script": None,
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": {
                                    "fail_fast": None,
                                    "target": None,
                                    "tasks": [
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": None,
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": None,
                                            "hooks": None,
                                            "inline": None,
                                            "name": "torch-ddp-create-torch-service",
                                            "on_exit": None,
                                            "template": "torch-ddp-create-torch-service",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_iter",
                                                        "value": "{{workflow.parameters.n_iter}}",
                                                        "value_from": None,
                                                    },
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_seconds_sleep",
                                                        "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                        "value_from": None,
                                                    },
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "torch-ddp-create-torch-service",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "torch-ddp-0",
                                            "on_exit": None,
                                            "template": "torch-ddp-0",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_iter",
                                                        "value": "{{workflow.parameters.n_iter}}",
                                                        "value_from": None,
                                                    },
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_seconds_sleep",
                                                        "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                        "value_from": None,
                                                    },
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "torch-ddp-create-torch-service",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "torch-ddp-0-worker-1",
                                            "on_exit": None,
                                            "template": "torch-ddp-1",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_iter",
                                                        "value": "{{workflow.parameters.n_iter}}",
                                                        "value_from": None,
                                                    },
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_seconds_sleep",
                                                        "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                        "value_from": None,
                                                    },
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "torch-ddp-create-torch-service",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "torch-ddp-0-worker-2",
                                            "on_exit": None,
                                            "template": "torch-ddp-2",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_iter",
                                                        "value": "{{workflow.parameters.n_iter}}",
                                                        "value_from": None,
                                                    },
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "n_seconds_sleep",
                                                        "value": "{{workflow.parameters.n_seconds_sleep}}",
                                                        "value_from": None,
                                                    },
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "torch-ddp-create-torch-service",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "torch-ddp-0-worker-3",
                                            "on_exit": None,
                                            "template": "torch-ddp-3",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": None,
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "torch-ddp-0",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "torch-ddp-delete-torch-service",
                                            "on_exit": None,
                                            "template": "torch-ddp-delete-torch-service",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                        {
                                            "arguments": {
                                                "artifacts": None,
                                                "parameters": [
                                                    {
                                                        "default": None,
                                                        "description": None,
                                                        "enum": None,
                                                        "global_name": None,
                                                        "name": "a",
                                                        "value": "{{tasks.torch-ddp-0.outputs.parameters.duration}}",
                                                        "value_from": None,
                                                    }
                                                ],
                                            },
                                            "continue_on": None,
                                            "dependencies": None,
                                            "depends": "torch-ddp-0",
                                            "hooks": None,
                                            "inline": None,
                                            "name": "show-duration-param-0",
                                            "on_exit": None,
                                            "template": "show-duration-param",
                                            "template_ref": None,
                                            "when": None,
                                            "with_items": None,
                                            "with_param": None,
                                            "with_sequence": None,
                                        },
                                    ],
                                },
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": None,
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "bettmensch-ai-dag",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": None,
                                "scheduler_name": None,
                                "script": None,
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": "100",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_iter",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "10",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_seconds_sleep",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "None",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": None,
                                        },
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": {
                                        "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                        "torch-node": "0",
                                    },
                                },
                                "metrics": None,
                                "name": "torch-ddp-0",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": {
                                                "config_map_key_ref": None,
                                                "default": None,
                                                "event": None,
                                                "expression": None,
                                                "jq_filter": None,
                                                "json_path": None,
                                                "parameter": None,
                                                "path": "duration",
                                                "supplied": None,
                                            },
                                        }
                                    ],
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": [
                                        {
                                            "name": "NCCL_DEBUG",
                                            "value": "INFO",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_node_rank",
                                            "value": "0",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_start_method",
                                            "value": "fork",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                            "value": "static",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                            "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                            "value": "29200",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_run_id",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_tee",
                                            "value": "0",
                                            "value_from": None,
                                        },
                                    ],
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": [
                                        {
                                            "container_port": 29200,
                                            "host_ip": None,
                                            "host_port": None,
                                            "name": "ddp",
                                            "protocol": "TCP",
                                        }
                                    ],
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": [
                                    {
                                        "effect": "NoSchedule",
                                        "key": "nvidia.com/gpu",
                                        "operator": "Exists",
                                        "toleration_seconds": None,
                                        "value": None,
                                    }
                                ],
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": "100",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_iter",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "10",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_seconds_sleep",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "None",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": None,
                                        },
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": {
                                        "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                        "torch-node": "1",
                                    },
                                },
                                "metrics": None,
                                "name": "torch-ddp-1",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": {
                                                "config_map_key_ref": None,
                                                "default": None,
                                                "event": None,
                                                "expression": None,
                                                "jq_filter": None,
                                                "json_path": None,
                                                "parameter": None,
                                                "path": "duration",
                                                "supplied": None,
                                            },
                                        }
                                    ],
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": [
                                        {
                                            "name": "NCCL_DEBUG",
                                            "value": "INFO",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_node_rank",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_start_method",
                                            "value": "fork",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                            "value": "static",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                            "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                            "value": "29200",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_run_id",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_tee",
                                            "value": "0",
                                            "value_from": None,
                                        },
                                    ],
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": [
                                    {
                                        "effect": "NoSchedule",
                                        "key": "nvidia.com/gpu",
                                        "operator": "Exists",
                                        "toleration_seconds": None,
                                        "value": None,
                                    }
                                ],
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": "100",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_iter",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "10",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_seconds_sleep",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "None",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": None,
                                        },
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": {
                                        "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                        "torch-node": "2",
                                    },
                                },
                                "metrics": None,
                                "name": "torch-ddp-2",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": {
                                                "config_map_key_ref": None,
                                                "default": None,
                                                "event": None,
                                                "expression": None,
                                                "jq_filter": None,
                                                "json_path": None,
                                                "parameter": None,
                                                "path": "duration",
                                                "supplied": None,
                                            },
                                        }
                                    ],
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": [
                                        {
                                            "name": "NCCL_DEBUG",
                                            "value": "INFO",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_node_rank",
                                            "value": "2",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_start_method",
                                            "value": "fork",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                            "value": "static",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                            "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                            "value": "29200",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_run_id",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_tee",
                                            "value": "0",
                                            "value_from": None,
                                        },
                                    ],
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": [
                                    {
                                        "effect": "NoSchedule",
                                        "key": "nvidia.com/gpu",
                                        "operator": "Exists",
                                        "toleration_seconds": None,
                                        "value": None,
                                    }
                                ],
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": "100",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_iter",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "10",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "n_seconds_sleep",
                                            "value": None,
                                            "value_from": None,
                                        },
                                        {
                                            "default": "None",
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": None,
                                        },
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": {
                                        "torch-job": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6",
                                        "torch-node": "3",
                                    },
                                },
                                "metrics": None,
                                "name": "torch-ddp-3",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "duration",
                                            "value": None,
                                            "value_from": {
                                                "config_map_key_ref": None,
                                                "default": None,
                                                "event": None,
                                                "expression": None,
                                                "jq_filter": None,
                                                "json_path": None,
                                                "parameter": None,
                                                "path": "duration",
                                                "supplied": None,
                                            },
                                        }
                                    ],
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": "topologySpreadConstraints:\n- maxSkew: 1\n  topologyKey: kubernetes.io/hostname\n  whenUnsatisfiable: DoNotSchedule\n  labelSelector:\n    matchExpressions:\n      - { key: torch-node, operator: In, values: ['0','1','2','3','4','5']}",
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": [
                                        {
                                            "name": "NCCL_DEBUG",
                                            "value": "INFO",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_min_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_nodes",
                                            "value": "4",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_node_rank",
                                            "value": "3",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_nproc_per_node",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_max_restarts",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_start_method",
                                            "value": "fork",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_backend",
                                            "value": "static",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_url",
                                            "value": "torch-ddp-0-c3ee0689-7a0b-4be4-8754-a019d7030eb6.argo.svc.cluster.local",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_rdzv_endpoint_port",
                                            "value": "29200",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_run_id",
                                            "value": "1",
                                            "value_from": None,
                                        },
                                        {
                                            "name": "bettmensch_ai_distributed_torch_tee",
                                            "value": "0",
                                            "value_from": None,
                                        },
                                    ],
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai-torch:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "700Mi",
                                            "nvidia.com/gpu": "1",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: n_iter = json.loads(r'''{{inputs.parameters.n_iter}}''')\nexcept: n_iter = r'''{{inputs.parameters.n_iter}}'''\ntry: n_seconds_sleep = json.loads(r'''{{inputs.parameters.n_seconds_sleep}}''')\nexcept: n_seconds_sleep = r'''{{inputs.parameters.n_seconds_sleep}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\nfrom bettmensch_ai.io import OutputParameter\nduration = OutputParameter(\"duration\")\n\ndef torch_ddp(n_iter: InputParameter=100, n_seconds_sleep: InputParameter=10, duration: OutputParameter=None) -> None:\n    \"\"\"When decorated with the torch_component decorator, implements a\n    bettmensch_ai.TorchComponent that runs a torch DDP across pods and nodes in\n    your K8s cluster.\"\"\"\n    import time\n    from datetime import datetime as dt\n    import torch\n    import torch.distributed as dist\n    has_gpu = torch.cuda.is_available()\n    print(f'GPU present: {has_gpu}')\n    if has_gpu:\n        dist.init_process_group(backend='nccl')\n    else:\n        dist.init_process_group(backend='gloo')\n    for i in range(1, n_iter + 1):\n        time.sleep(n_seconds_sleep)\n        a = torch.tensor([dist.get_rank()])\n        print(f'{i}/{n_iter}: @{dt.now()}')\n        print(f'{i}/{n_iter}: Backend {dist.get_backend()}')\n        print(f'{i}/{n_iter}: World size {dist.get_world_size()}')\n        print(f'{i}/{n_iter}: Rank {dist.get_rank()}')\n        print(f'{i}/{n_iter}: This makes me worker process {dist.get_rank() + 1}/{dist.get_world_size()} globally!')\n        if has_gpu:\n            device = torch.device('cuda:0')\n            device_count = torch.cuda.device_count()\n            print(f'{i}/{n_iter}: GPU count: {device_count}')\n            device_name = torch.cuda.get_device_name(0)\n            print(f'{i}/{n_iter}: GPU name: {device_name}')\n            device_property = torch.cuda.get_device_capability(device)\n            print(f'{i}/{n_iter}: GPU property: {device_property}')\n        else:\n            device = torch.device('cpu')\n        a_placed = a.to(device)\n        print(f'{i}/{n_iter}: Pre-`all_reduce` tensor: {a_placed}')\n        dist.all_reduce(a_placed)\n        print(f'{i}/{n_iter}: Post-`all_reduce` tensor: {a_placed}')\n        print('===================================================')\n    if duration is not None:\n        duration_seconds = n_iter * n_seconds_sleep\n        duration.assign(duration_seconds)\n\nfrom bettmensch_ai.components import torch_distribute\n\ntorch_distribute_decorator=torch_distribute()\ntorch_distributed_function=torch_distribute_decorator(torch_ddp)\n\ntorch_distributed_function(n_iter,n_seconds_sleep,duration)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": [
                                    {
                                        "effect": "NoSchedule",
                                        "key": "nvidia.com/gpu",
                                        "operator": "Exists",
                                        "toleration_seconds": None,
                                        "value": None,
                                    }
                                ],
                                "volumes": None,
                            },
                            {
                                "active_deadline_seconds": None,
                                "affinity": None,
                                "archive_location": None,
                                "automount_service_account_token": None,
                                "container": None,
                                "container_set": None,
                                "daemon": None,
                                "dag": None,
                                "data": None,
                                "executor": None,
                                "fail_fast": None,
                                "host_aliases": None,
                                "http": None,
                                "init_containers": None,
                                "inputs": {
                                    "artifacts": None,
                                    "parameters": [
                                        {
                                            "default": None,
                                            "description": None,
                                            "enum": None,
                                            "global_name": None,
                                            "name": "a",
                                            "value": None,
                                            "value_from": None,
                                        }
                                    ],
                                },
                                "memoize": None,
                                "metadata": {
                                    "annotations": None,
                                    "labels": None,
                                },
                                "metrics": None,
                                "name": "show-duration-param",
                                "node_selector": None,
                                "outputs": {
                                    "artifacts": None,
                                    "exit_code": None,
                                    "parameters": None,
                                    "result": None,
                                },
                                "parallelism": None,
                                "plugin": None,
                                "pod_spec_patch": None,
                                "priority": None,
                                "priority_class_name": None,
                                "resource": None,
                                "retry_strategy": {
                                    "affinity": None,
                                    "backoff": None,
                                    "expression": None,
                                    "limit": "1",
                                    "retry_policy": "OnError",
                                },
                                "scheduler_name": None,
                                "script": {
                                    "args": None,
                                    "command": ["python"],
                                    "env": None,
                                    "env_from": None,
                                    "image": "bettmensch88/bettmensch.ai:3.11-latest",
                                    "image_pull_policy": "Always",
                                    "lifecycle": None,
                                    "liveness_probe": None,
                                    "name": "",
                                    "ports": None,
                                    "readiness_probe": None,
                                    "resources": {
                                        "limits": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                        "requests": {
                                            "cpu": "100m",
                                            "memory": "100Mi",
                                        },
                                    },
                                    "security_context": None,
                                    "source": "import os\nimport sys\nsys.path.append(os.getcwd())\n\n# --- preprocessing\nimport json\ntry: a = json.loads(r'''{{inputs.parameters.a}}''')\nexcept: a = r'''{{inputs.parameters.a}}'''\n\nfrom bettmensch_ai.io import InputParameter\n\ndef show_parameter(a: InputParameter) -> None:\n    \"\"\"When decorated with the bettmensch_ai.components.component decorator,\n    implements a bettmensch_ai.Component that prints the values of its\n    InputParameter.\"\"\"\n    print(f'Content of input parameter a is: {a}')\nshow_parameter(a)",
                                    "startup_probe": None,
                                    "stdin": None,
                                    "stdin_once": None,
                                    "termination_message_path": None,
                                    "termination_message_policy": None,
                                    "tty": None,
                                    "volume_devices": None,
                                    "volume_mounts": None,
                                    "working_dir": None,
                                },
                                "security_context": None,
                                "service_account_name": None,
                                "sidecars": None,
                                "steps": None,
                                "suspend": None,
                                "synchronization": None,
                                "timeout": None,
                                "tolerations": None,
                                "volumes": None,
                            },
                        ],
                        "tolerations": None,
                        "ttl_strategy": None,
                        "volume_claim_gc": None,
                        "volume_claim_templates": None,
                        "volumes": None,
                        "workflow_metadata": None,
                        "workflow_template_ref": {
                            "cluster_scope": None,
                            "name": "pipeline-test-torch-gpu-pipeline-dcfq8",
                        },
                    },
                    "synchronization": None,
                    "task_results_completion_status": {
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1501533811": True,
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-1906221877": True,
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2258088662": True,
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2336401843": True,
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2953909358": True,
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-2966531784": True,
                        "pipeline-test-torch-gpu-pipeline-dcfq8-flow-2tzsx-842282759": True,
                    },
                },
            }

    return MockHeraWorkflowModel()
